sap.ui.require.preload({"sap/ushell/components/shell/Notifications/Component.js":function(){
// ${copyright}
sap.ui.define(['sap/ushell/resources','sap/ui/core/UIComponent','sap/ushell/renderers/fiori2/AccessKeysHandler','sap/ushell/utils','sap/ushell/ui/shell/RightFloatingContainer','sap/ushell/EventHub','sap/ui/Device','sap/ushell/Config'],function(r,U,A,u,R,E,D,C){"use strict";return U.extend("sap.ushell.components.shell.Notifications.Component",{metadata:{version:"${version}",library:"sap.ushell.components.shell.Notifications",dependencies:{libs:["sap.m"]},config:{}},createContent:function(){this.oRenderer=sap.ushell.Container.getRenderer("fiori2");this.oDefConfig={};this.bIsViewCreated=false;this.isNotificationPreviewLoaded=false;this.oNotificationsPreviewModel=undefined;this.AccessKeysHandler=A;var t=this;var a=h.bind(this);var n;var f=function(N){var b=this.mBindingInfos[N],d=this.getMetadata().getJSONKeys()[N],e;jQuery.each(this[d._sGetter](),jQuery.proxy(function(i,v){this[d._sRemoveMutator](v);},this));jQuery.each(b.binding.getContexts(),jQuery.proxy(function(i,v){e=b.factory(this.getId()+"-"+i,v)?b.factory(this.getId()+"-"+i,v).setBindingContext(v,b.model):"";this[d._sMutator](e);},this));};this.oPreviewNotificationsContainerPlaceholder=new R({id:'notifications-preview-container-placeholder',visible:{path:'/enableNotificationsPreview',formatter:function(v){return t._handleNotificationsPreviewVisibility.apply(t,[v]);}}}).addStyleClass('sapUshellPreviewNotificationsConainer');this.oPreviewNotificationsContainer=new R({id:'notifications-preview-container',top:4,right:'1rem',actAsPreviewContainer:true,floatingContainerItems:{path:"/previewNotificationItems",factory:function(b,d){return sap.ui.getCore().byId(d.getObject().previewItemId);}},insertItemsWithAnimation:{path:'/animationMode',formatter:function(s){return s!=='minimal';}},visible:{path:'/enableNotificationsPreview',formatter:this._handleNotificationsPreviewVisibility.bind(this)}}).addStyleClass('sapContrastPlus').addStyleClass('sapContrast');this.oPreviewNotificationsContainer.updateAggregation=f;sap.ui.getCore().getEventBus().subscribe("sap.ushell.services.Notifications","onNewNotifications",this._handleAlerts,this);this.subscribeAndPublishNotificationEvents();this.oNotificationsPreviewModel=this.oPreviewNotificationsContainer.getModel();var o=(this.getComponentData()?this.getComponentData().config:{});this.oDefConfig={view:{position:"right"},enableHeaderButton:true,enablePreview:true};this._updateNotificationConfiguration();if(sap.ushell.Container.getService("Notifications").isEnabled()===true){sap.ushell.Container.getRenderer("fiori2").shellCtrl.getModel().setProperty("/enableNotifications",true);sap.ushell.Container.getService("Notifications").init();if(this.oRenderer.getShellConfig().enableNotificationsUI===true){sap.ushell.Container.getRenderer("fiori2").shellCtrl.getModel().setProperty("/enableNotificationsUI",true);sap.ushell.Container.getService("Notifications").registerDependencyNotificationsUpdateCallback(this.notificationsCountUpdateCallback.bind(this),true);}}this.oDefConfig=jQuery.extend(this.oDefConfig,o);var I=C.last("/core/shell/enableFiori3")===true?"bell":"ui-notifications";n=sap.ui.getCore().byId("NotificationsCountButton");n.applySettings({icon:sap.ui.core.IconPool.getIconURI(I),visible:"{/enableNotifications}",enabled:"{/enableNotifications}",selected:false,press:function(){a(this,!this.getSelected());},showSeparator:false,tooltip:r.i18n.getText("NotificationToggleButtonExpanded")},true,true).removeStyleClass("sapUshellPlaceHolders");n.addEventDelegate({onAfterRendering:function(){this.$().attr("aria-pressed",t.oRenderer.getNotificationsSelected());if(this.getDisplayFloatingNumber()>0){this.$().attr("aria-label",r.i18n.getText("NotificationToggleButtonCollapsed",this.getDisplayFloatingNumber()));}else{this.$().attr("aria-label",r.i18n.getText("NotificationToggleButtonCollapsedNoNotifications"));}}.bind(n),onsapskipforward:function(e){t.AccessKeysHandler.bForwardNavigation=true;e.preventDefault();jQuery("#sapUshellHeaderAccessibilityHelper").focus();},onsaptabnext:function(e){t.AccessKeysHandler.bForwardNavigation=true;e.preventDefault();jQuery("#sapUshellHeaderAccessibilityHelper").focus();},onsapskipback:function(e){if(t.AccessKeysHandler.getAppKeysHandler()){e.preventDefault();t.AccessKeysHandler.bFocusOnShell=false;}}});this.oRenderer.addShellDanglingControl(n);if(sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel().getProperty("/enableNotificationsUI")===true){sap.ushell.Container.getRenderer("fiori2").oShellModel.addHeaderEndItem(["NotificationsCountButton"],false,["home","app","minimal"],true);}if(D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name==="Phone"){sap.ushell.Container.getRenderer("fiori2").getShellController().handleEndItemsOverflow({name:'Phone',showOverFlowBtn:true});}E.on('showNotifications').do(function(v){a(n,v);});},_notificationsUpdateCallback:function(){var t=this,a=5,T=0,b=this.oNotificationsPreviewModel.getProperty("/previewNotificationItems"),n=[],N=[],d,e,f,g,j,i,o,k=false,m=a-b.length-1;sap.ushell.Container.getService("Notifications").getNotifications().done(function(l){if(!l){return;}var p=sap.ui.getCore().byId("notifications-preview-container"),v;if(!this.isNotificationPreviewLoaded){p.setEnableBounceAnimations(true);}sap.ushell.Container.getService("Notifications")._initializeDismissNotifications();if(b&&b.length){for(j=0;j<b.length;j++){var O=b[j].originalItemId,q=false;for(i=0;i<l.length;i++){if(l[i].Id===O){q=true;break;}if(b[j].originalTimestamp>l[i].CreatedAt){break;}}if(!q){b.splice(j,1);k=true;j--;}}}if(b&&b.length>0){d=b[0].originalTimestamp;e=sap.ushell.Container.getService("Notifications")._formatAsDate(d);}for(j=0;(j<l.length)&&(T<a);j++){f=l[j].CreatedAt;g=sap.ushell.Container.getService("Notifications")._formatAsDate(f);if((e?g>e:true)){n[T]=l[j];T++;}}var s=n.length;if(b&&b.length>0&&b.length<a&&l.length>b.length){d=b[b.length-1].originalTimestamp;e=sap.ushell.Container.getService("Notifications")._formatAsDate(d);T=0;for(j=0;(j<l.length)&&(T<=m);j++){f=l[j].CreatedAt;g=sap.ushell.Container.getService("Notifications")._formatAsDate(f);if(g<e){n[s+T]=l[j];T++;}}}if(n.length===0&&!k){this._disableNotificationPreviewBouncingAnimation(p);return;}for(i=0;i<n.length;i++){o=new sap.m.NotificationListItem({hideShowMoreButton:true,title:n[i].SensitiveText?n[i].SensitiveText:n[i].Text,description:n[i].SubTitle,datetime:u.formatDate(n[i].CreatedAt),priority:sap.ui.core.Priority[n[i].Priority.charAt(0)+n[i].Priority.substr(1).toLowerCase()],press:function(w){var x=this.getBindingContext().getPath(),P=x.split("/"),y="/"+P[1]+"/"+P[2],z=this.getModel().getProperty(y),S=z.NavigationTargetObject,B=z.NavigationTargetAction,F=z.NavigationTargetParams,G=z.originalItemId,H=sap.ushell.Container.getService("Notifications");u.toExternalWithParameters(S,B,F);var I=H.markRead(G);I.fail(function(){sap.ushell.Container.getService('Message').error(r.i18n.getText('notificationsFailedMarkRead'));});},close:function(w){var x=this.getBindingContext().getPath(),P=x.split("/"),y="/"+P[1]+"/"+P[2],z=this.getModel().getProperty(y),B=z.originalItemId,b=t.oNotificationsPreviewModel.getProperty("/previewNotificationItems"),F=sap.ushell.Container.getService("Notifications"),G=F.dismissNotification(B);G.done(function(){var i;for(i=0;i<b.length;i++){if(b[i].originalItemId===B){break;}}b.splice(i,1);t.oNotificationsPreviewModel.setProperty("/previewNotificationItems",b);});G.fail(function(){sap.ushell.Container.getService('Message').error(r.i18n.getText('notificationsFailedDismiss'));t.oNotificationsPreviewModel.setProperty("/previewNotificationItems",b);});}}).addStyleClass("sapUshellNotificationsListItem");N.push({previewItemId:o.getId(),originalItemId:n[i].Id,originalTimestamp:n[i].CreatedAt,NavigationTargetObject:n[i].NavigationTargetObject,NavigationTargetAction:n[i].NavigationTargetAction,NavigationTargetParams:n[i].NavigationTargetParams});v=sap.ui.getCore().byId('viewPortContainer');if(v.getCurrentState()==="RightCenter"){o.addStyleClass("sapUshellRightFloatingContainerItemBounceOut");}}if(b.length===0){t.oNotificationsPreviewModel.setProperty("/previewNotificationItems",N);this._disableNotificationPreviewBouncingAnimation(p);return;}for(j=N.length-1;j>-1;j--){if(b.length>=a){setTimeout(function(){b.pop();t.oNotificationsPreviewModel.setProperty("/previewNotificationItems",b);},1000);}if(N[j].originalTimestamp>b[0].originalTimestamp){b.unshift(N[j]);}else{b.push(N[j]);}}t.oNotificationsPreviewModel.setProperty("/previewNotificationItems",b);this._disableNotificationPreviewBouncingAnimation(p);}.bind(this)).fail(function(){});},_disableNotificationPreviewBouncingAnimation:function(n){if(!this.isNotificationPreviewLoaded){this.isNotificationPreviewLoaded=true;n.setEnableBounceAnimations(false);}},_handleNotificationsPreviewVisibility:function(e){var s=this.oRenderer.getCurrentViewportState(),i=s==='Center',n=sap.ushell.Container.getService('Notifications');sap.ui.getCore().getEventBus().publish("shell","setPlaceForNotificationsPreview",{EnableNotificationsPreview:e});e=e&&i;if(e){if(!this.bNotificationsRegistered){n.registerNotificationsUpdateCallback(this._notificationsUpdateCallback.bind(this));this.bNotificationsRegistered=true;}if(n.isFirstDataLoaded()){setTimeout(function(){if(this.oController&&this.oController._notificationsUpdateCallback){this.oController._notificationsUpdateCallback();}}.bind(this),300);}if(!this.bSubscribedToViewportStateSwitch){this.bHeadsupNotificationsInitialyVisible=this.oRenderer.getRightFloatingContainerVisibility();sap.ui.getCore().getEventBus().subscribe("launchpad","afterSwitchState",this._handleViewportStateSwitch,this);this.bSubscribedToViewportStateSwitch=true;}this._handleHeadsupNotificationsPresentation(s);}return e;},_handleViewportStateSwitch:function(s,e,d){var a=d.getParameter('to');if(a=='Center'){var n=sap.ui.getCore().byId("notifications-preview-container");if(n&&n.setFloatingContainerItemsVisiblity){n.setFloatingContainerItemsVisiblity(true);}}},_handleHeadsupNotificationsPresentation:function(s){var i=s==='Center',p=this.oPreviewNotificationsContainer.getDomRef(),H=p&&p.getBoundingClientRect(),P=H?H.bottom<0:false,S=i?P:this.bHeadsupNotificationsInitialyVisible;this.oRenderer.showRightFloatingContainer(S);},_handleAlerts:function(s,e,n){var N;if(this.oRenderer.getViewPortContainerCurrentState()!=='RightCenter'){for(N=0;N<n.length;N++){this.handleNotification(n[N]);}}},handleNotification:function(n){var a=this.oRenderer.addRightFloatingContainerItem({press:function(e){var v=sap.ui.getCore().byId('viewPortContainer');if(window.hasher.getHash()===n.NavigationTargetObject+"-"+n.NavigationTargetAction){v.switchState("Center");}else{u.toExternalWithParameters(n.NavigationTargetObject,n.NavigationTargetAction,n.NavigationTargetParams);}sap.ushell.Container.getService("Notifications").markRead(n.Id);},datetime:r.i18n.getText("notification_arrival_time_now"),title:n.SensitiveText?n.SensitiveText:n.Text,description:n.SubTitle,unread:n.IsRead,priority:"High",hideShowMoreButton:true},true,true);var t=this;setTimeout(function(){t.oRenderer.removeRightFloatingContainerItem(a.getId(),true);},3500);},notificationsCountUpdateCallback:function(d){var t=this,v=this.oRenderer.getViewPortContainerCurrentState(),i=v==="RightCenter";if((d===undefined)||(!i)){this._updateBadge();}else{d.done(function(){t._updateBadge();});}},_updateBadge:function(){var n;sap.ushell.Container.getService("Notifications").getUnseenNotificationsCount().done(function(N){n=parseInt(N,10);sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel().setProperty('/notificationsCount',n);}).fail(function(d){jQuery.sap.log.error("Shell.controller - call to notificationsService.getCount failed: ",d,"sap.ushell.renderers.lean.Shell");});},_switchToNotificationView:function(s){this.oRenderer.ViewPortContainerNavTo('rightViewPort',"notificationsView",'show');this.oRenderer.switchViewPortStateByControl(s,"RightCenter");sap.ui.getCore().getEventBus().publish("launchpad","notificationViewOpened");},_switchToNotificationViewWithPreview:function(n,a,s){if(a==='minimal'){this._switchToNotificationView(s);}else{var i=n.getFloatingContainerItems().length;setTimeout(function(){this._switchToNotificationView(s);}.bind(this),300+(i*100));}},_updateNotificationConfiguration:function(s,e,d){var o=this.oRenderer.getModelConfiguration(),b=o.enableNotificationsUI,n=sap.ushell.Container.getService("Notifications").isEnabled(),N=o.appState!=="embedded"&&o.appState!=="headerless"&&o.appState!=="merged"&&o.appState!=="standalone",a=true,p=true,f,g=D.system.desktop||D.system.tablet||D.system.combi,P={};if(n===true){f=sap.ushell.Container.getService("Notifications").getUserSettingsFlags();f.done(function(i){a=i.previewNotificationEnabled;P.bUserEnableNotificationsPreview=a;P.bConfigEnableNotificationsPreview=p;P.bMainFlagExists=false;if(p&&b&&n&&g&&N){P.bMainFlagExists=true;P.bEnableNotificationsPreview=a;}if(!C.last("/core/shell/enableFiori3")){sap.ui.getCore().getEventBus().publish("shell","changeNotificationPreview",P);}});}},exit:function(){sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.services.Notifications","onNewNotifications",this._handleAlerts,this);sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.services.Notifications","enablePreviewNotificationChanged",this._updateNotificationConfiguration,this);if(this.bSubscribedToViewportStateSwitch){sap.ui.getCore().getEventBus().unsubscribe("launchpad","afterSwitchState",this._handleViewportStateSwitch,this);this.bSubscribedToViewportStateSwitch=false;}if(sap.ushell.Container){if(sap.ushell.Container.getService("Notifications").isEnabled()===true){sap.ushell.Container.getService("Notifications").destroy();}}this.oPreviewNotificationsContainerPlaceholder.destroy();this.oPreviewNotificationsContainer.destroy();},subscribeAndPublishNotificationEvents:function(){var n=sap.ushell.Container.getService("Notifications")._getNotificationSettingsPreviewVisible();if(n){sap.ui.getCore().getEventBus().subscribe("sap.ushell.services.Notifications","enablePreviewNotificationChanged",this._updateNotificationConfiguration,this).publish("shell","notificationsPreviewContainerCreated",{previewNotificationsContainerPlaceholder:this.oPreviewNotificationsContainerPlaceholder,previewNotificationsContainer:this.oPreviewNotificationsContainer});}}});function c(o){if(o.oDefConfig.view&&o.bIsViewCreated==false){var n=sap.ui.view("notificationsView",{viewName:"sap.ushell.components.shell.Notifications.Notifications",type:'JS',viewData:{}});n.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"role",value:"region",writeToDom:true}));n.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"aria-label",value:r.i18n.getText("NotificationToggleButtonExpanded"),writeToDom:true}));o.bIsViewCreated=true;if(o.oDefConfig.view.position==="right"){o.oRenderer.addRightViewPort(n);}else{o.oRenderer.addLeftViewPort(n);}}}function h(s,S){S=!!S;if(s.getSelected()===S){return;}s.setSelected(S);var n=sap.ui.getCore().byId("notifications-preview-container"),a=sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel().getProperty('/animationMode')||'full';var b;c(this);if(S){sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel().setProperty("/notificationsCount",0);if(n){n.setFloatingContainerItemsVisiblity(false);this._switchToNotificationViewWithPreview(n,a,s);}else{this._switchToNotificationView(s);}}else{b=sap.ushell.Container.getService("Notifications").filterDismisssedItems(this.oNotificationsPreviewModel.getProperty("/previewNotificationItems"),sap.ushell.Container.getService("Notifications")._getDismissNotifications());this.oNotificationsPreviewModel.setProperty("/previewNotificationItems",b);this.oRenderer.switchViewPortStateByControl(s,"Center");}sap.ushell.Container.getService("Notifications").notificationsSeen();sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel().setProperty("/notificationsCount",0);s.$().attr("aria-pressed",S);s.$().attr("aria-label",r.i18n.getText("NotificationToggleButtonCollapsedNoNotifications"));}});},"sap/ushell/components/shell/Notifications/Notifications.controller.js":function(){sap.ui.define(['sap/ushell/utils'],function(u){"use strict";sap.ui.controller("sap.ushell.components.shell.Notifications.Notifications",{oPagingConfiguration:{MAX_NOTIFICATION_ITEMS_DESKTOP:400,MAX_NOTIFICATION_ITEMS_MOBILE:100,MIN_NOTIFICATION_ITEMS_PER_BUFFER:15,NOTIFICATION_ITEM_HEIGHT:(sap.ui.Device.system.phone||sap.ui.Device.system.tablet)?130:100,TAB_BAR_HEIGHT:100},onInit:function(){var i={};this.iMaxNotificationItemsForDevice=sap.ui.Device.system.desktop?this.oPagingConfiguration.MAX_NOTIFICATION_ITEMS_DESKTOP:this.oPagingConfiguration.MAX_NOTIFICATION_ITEMS_MOBILE;this.oNotificationsService=sap.ushell.Container.getService("Notifications");this.oSortingType=this.oNotificationsService.getOperationEnum();i[this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING]=this.getInitialSortingModelStructure();i[this.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING]=this.getInitialSortingModelStructure();i[this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING]=this.getInitialSortingModelStructure();i[this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING]={};this.sCurrentSorting=this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING;this.sCurrentExpandedType=undefined;var m=new sap.ui.model.json.JSONModel(i);m.setSizeLimit(1500);this.getView().setModel(m);this.getNextBuffer();this._oTopNotificationData=undefined;},shouldFetchMoreNotifications:function(){var h=this.getView().getModel().getProperty("/"+this.sCurrentSorting+"/hasMoreItemsInBackend"),l=this.getView().getModel().getProperty("/"+this.sCurrentSorting+"/listMaxReached");return h&&!l;},getNextBuffer:function(){var c=this.getItemsFromModel(this.sCurrentSorting),n,p,N;if(!this.shouldFetchMoreNotifications()){return;}N=this.getNumberOfItemsToFetchOnScroll();if(N===0){this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/hasMoreItems",false);return;}if(c!==undefined){n=c.length;}if(n===0){this.addBusyIndicatorToTabFilter(true);}this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/inUpdate",true);p=this.oNotificationsService.getNotificationsBufferBySortingType(this.sCurrentSorting,n,N);p.done(function(r){var d=this.oNotificationsService._getNotificationSettingsAvalability();if(d.state()=="pending"){this.oNotificationsService._userSettingInitialization();}this.addBufferToModel(r);}.bind(this));p.fail(function(r){if(n===0){this.handleError();}}.bind(this));},getNextBufferForType:function(){var s=this.sCurrentExpandedType,S=this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,g=this.getGroupFromModel(s),c=g?g.aNotifications:undefined,n=0,p,h=g.hasMoreItems;if(!h){return;}if(c!==undefined){n=c.length;}this.getView().getModel().setProperty("/"+S+"/inUpdate",true);p=this.oNotificationsService.getNotificationsBufferInGroup(s,n,this.getBasicBufferSize());p.done(function(r){this.addTypeBufferToModel(s,r,false);}.bind(this));p.fail(function(r){this.getNextBufferFailHandler(S);}.bind(this));},addTypeHeadersToModel:function(r){var c=this.getItemsFromModel(this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING),C=c.length,R;this._oTopNotificationData=undefined;if(!r){return;}R=JSON.parse(r).value;R.forEach(function(i,a){i.hasMoreItems=true;i.aNotifications=[{"Id":"temp"}];});this.getView().getModel().setProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING+"/aGroupHeaders",R);this.getView().getModel().setProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING+"/inUpdate",false);if(C===0){this.removeBusyIndicatorToTabFilter(false);}},addBufferToModel:function(r){var c=this.getItemsFromModel(this.sCurrentSorting),C=c.length,m,h=r.length>=this.getNumberOfItemsToFetchOnScroll();this._oTopNotificationData=undefined;if(!r){this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/hasMoreItemsInBackend",false);return;}this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/hasMoreItemsInBackend",h);m=c.concat(r);this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/aNotifications",m);this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/inUpdate",false);if(m.length>=this.iMaxNotificationItemsForDevice){this.handleMaxReached();}if(C===0){this.removeBusyIndicatorToTabFilter(true);}},addTypeBufferToModel:function(t,r,o){var g=this.getGroupFromModel(t),G=this.getGroupIndexFromModel(t),a=this.getView().getModel().getProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING),m;if(!r){return;}if(r.length<this.getBasicBufferSize()){g.hasMoreItems=false;}if(!g.aNotifications||o){g.aNotifications=[];}m=g.aNotifications.concat(r);a[G].aNotifications=m;a[G].Busy=false;this.getView().getModel().setProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,a);this.getView().getModel().setProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING+"/inUpdate",false);},keydownHandler:function(k){var j,n,c;if(k.keyCode===jQuery.sap.KeyCodes.DELETE){j=jQuery(document.activeElement);if(j.hasClass('sapUshellNotificationsListItem')){n=j.next();c=j.find(".sapMNLB-CloseButton")[0];sap.ui.getCore().byId(c.id).firePress();if(n){n.focus();}}}},notificationsUpdateCallback:function(d){var t=this,c,n,N;if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING){this.notificationsUpdateCallbackForType();d.resolve();return;}c=this.getItemsFromModel(this.sCurrentSorting);if(c!==undefined){n=c.length;}this.cleanModel();N=this.getNumberOfItemsToFetchOnUpdate(n);this.oNotificationsService.getNotificationsBufferBySortingType(this.sCurrentSorting,0,N).done(function(a){if(!a){return;}d.resolve();t.replaceItemsInModel(a,N);}).fail(function(a){jQuery.sap.log.error("Notifications control - call to notificationsService.getNotificationsBufferBySortingType failed: ",a,"sap.ushell.components.shell.Notifications.Notifications");});},getSelectedList:function(){var s;if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING){s=this.getView().oNotificationsListPriority;}else{s=this.getView().oNotificationsListDate;}return s;},isMoreCircleExist:function(){var s=this.getSelectedList(),i=s.getItems().length,l=s.getItems()[i-1];return!!i&&l.getMetadata().getName()==="sap.m.CustomListItem";},handleMaxReached:function(){var s=this.getSelectedList(),n=Math.floor(this.oNotificationsService.getNotificationsCount()),m=n-this.iMaxNotificationItemsForDevice,i=this.isMoreCircleExist();this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/moreNotificationCount",m);this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/listMaxReached",m>=0);if(m>0&&!i){s.addItem(this.getView().getMoreCircle(this.sCurrentSorting));}else if(m<=0&&i){s.removeItem(this.getView().oMoreListItem);}},reAddFailedGroup:function(g){var m=this.getView().getModel(),G=m.getProperty('/notificationsByTypeDescending');G.splice(g.removedGroupIndex,0,g.oGroup);m.setProperty('/notificationsByTypeDescending',G);},removeGroupFromModel:function(g){var m=this.getView().getModel(),G=m.getProperty('/notificationsByTypeDescending'),r={oGroup:g,removedGroupIndex:undefined};G.some(function(o,i){if(o.Id===g.Id){r.removedGroupIndex=i;G.splice(i,1);m.setProperty('/notificationsByTypeDescending',G);return true;}return false;});this.sCurrentExpandedType=undefined;return r;},updateGroupHeaders:function(){var p=this.oNotificationsService.getNotificationsGroupHeaders(),t=this,g=t.getView().getModel().getProperty("/"+t.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING);p.fail(function(d){jQuery.sap.log.error("Notifications control - call to notificationsService.updateGroupHeaders failed: ",d,"sap.ushell.components.shell.Notifications.Notifications");});p.done(function(n){var j=JSON.parse(n),a=j.value;a.forEach(function(i,b){var f=false;g.forEach(function(c,I){if(c.Id===i.Id){g[I].GroupHeaderText=i.GroupHeaderText;g[I].CreatedAt=i.CreatedAt;f=true;}});if(!f){g.unshift(i);}});t.getView().getModel().setProperty("/"+t.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,g);});},reloadGroupHeaders:function(){var p=this.oNotificationsService.getNotificationsGroupHeaders(),t=this;p.fail(function(d){jQuery.sap.log.error("Notifications control - call to notificationsService.getNotificationsGroupHeaders failed: ",d,"sap.ushell.components.shell.Notifications.Notifications");t.replaceBusyIndicatorWithNotificationsList();});p.done(function(n){var j=JSON.parse(n),a=j.value,r=[],l=-1;a.forEach(function(i,b){if(i.IsGroupHeader){i.Collapsed=true;r.push(i);l=l+1;}else if(r[l]){if(!r[l].notifications){r[l].notifications=[];}r[l].notifications.push(i);}});t.getView().getModel().setProperty("/"+t.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,r);t.replaceBusyIndicatorWithNotificationsList();});},markRead:function(n){var p=this.oNotificationsService.markRead(n),t=this;p.fail(function(){sap.ushell.Container.getService('Message').error(sap.ushell.resources.i18n.getText('notificationsFailedMarkRead'));t.setMarkReadOnModel(n,false);});this.setMarkReadOnModel(n,true);},onExit:function(){this.getView().oBusyIndicator.destroy();},onBeforeRendering:function(){this.oNotificationsService.registerDependencyNotificationsUpdateCallback(this.notificationsUpdateCallback.bind(this),false);},executeAction:function(n,a){return this.oNotificationsService.executeAction(n,a);},executeBulkAction:function(n,a,A,g,N,p){var t=g,P=this.oNotificationsService.executeBulkAction(g.Id,a),m,G=A,s=this.getView().getModel().getProperty(p+"/NotificationTypeDesc"),b=this;if(s===""){s=this.getView().getModel().getProperty(p+"/NotificationTypeKey");}P.fail(function(r){this.getView().getModel().setProperty(N+"/Busy",false);t.notifications.forEach(function(i,c){this.getView().getModel().setProperty(p+"/Busy",false);}.bind(this));if(r&&r.succededNotifications&&r.succededNotifications.length){r.succededNotifications.forEach(function(c,i){this.removeNotificationFromModel(c);}.bind(this));b.cleanModel();}if(r.succededNotifications.length===1){m=sap.ushell.resources.i18n.getText("notificationsPartialSuccessExecuteBulkAction",[G,r.succededNotifications.length,r.failedNotifications.length+r.succededNotifications.length,s,r.failedNotifications.length]);sap.m.MessageToast.show(m,{duration:4000});}else if(r.succededNotifications.length>1){m=sap.ushell.resources.i18n.getText("notificationsSingleSuccessExecuteBulkAction",[G,r.succededNotifications.length,r.failedNotifications.length+r.succededNotifications.length,s,r.failedNotifications.length]);sap.m.MessageToast.show(m,{duration:4000});}else{m=sap.ushell.resources.i18n.getText("notificationsFailedExecuteBulkAction");sap.ushell.Container.getService('Message').error(m);}}.bind(this));P.done(function(){m=sap.ushell.resources.i18n.getText("notificationsSuccessExecuteBulkAction",[G,s]);sap.m.MessageToast.show(m,{duration:4000});this.removeGroupFromModel(t);this.cleanModel();}.bind(this));},dismissNotification:function(n){var t=this,r=this.removeNotificationFromModel(n),p=this.oNotificationsService.dismissNotification(n);this.cleanModel();p.fail(function(){sap.ushell.Container.getService('Message').error(sap.ushell.resources.i18n.getText('notificationsFailedDismiss'));t.addNotificationToModel(r.obj,r.index);});},dismissBulkNotifications:function(n,g){var r=this.removeGroupFromModel(g),p=this.oNotificationsService.dismissBulkNotifications(g.Id);this.cleanModel();p.fail(function(){sap.ushell.Container.getService('Message').error(sap.ushell.resources.i18n.getText('notificationsFailedExecuteBulkAction'));this.reAddFailedGroup(r);}.bind(this));},onListItemPress:function(n,s,a,p){var v=sap.ui.getCore().byId('viewPortContainer');if(v){v.switchState("Center");}u.toExternalWithParameters(s,a,p);this.markRead(n);},scrollToItem:function(t){var j=this._getJqNotificationObjects(),a=j[0],b=j[1],c=j[2],d=j[3],i,n,e,f,g;if(a.length>0&&b.length>0&&c.length>0&&d.length>0){i=d.outerHeight(true)-window.parseInt(d.css("margin-top").replace("px",""));n=this.getIndexInModelByItemId(t.topItemId);n=n?n:0;e=n*i+window.parseInt(d.css("margin-top").replace("px",""));f=window.parseInt(b.css("padding-top").replace("px",""))+window.parseInt(c.css("padding-top").replace("px",""));g=a.offset().top;a.scrollTop(e+f+g-t.offSetTop);}this._oTopNotificationData=undefined;},_getJqNotificationObjects:function(){var j=jQuery("#notificationIconTabBar-containerContent"),a=j.children(),b=a.children(),c=j.find("li").first();return[j,a,b,c];},getTopOffSet:function(){var t=0,j=this._getJqNotificationObjects()[0];if(j.children().length>0&&j.children().children().length>0){t+=j.children().outerHeight()-j.children().height();t+=j.children().children().outerHeight()-j.children().children().height();}return t;},getTopItemOnTheScreen:function(){var j=this._getJqNotificationObjects()[0],t=0,i,a=0,b=this;t=this.getTopOffSet();j.find("li").each(function(){a=jQuery(this).offset().top;if(a>=t){i=b.getItemNotificationId(this);return false;}});return{topItemId:i,offSetTop:a};},handleError:function(){this.removeBusyIndicatorToTabFilter(true);try{sap.ushell.Container.getService("Message").error(sap.ushell.resources.i18n.getText("errorOccurredMsg"));}catch(e){jQuery.sap.log.error("Getting Message service failed.");}},addBusyIndicatorToTabFilter:function(i){var t=this.getSelectedTabFilter(),I=this.getView().oIconTabBar;if(i){I.addStyleClass('sapUshellNotificationIconTabByTypeWithBusyIndicator');t.removeAllContent();t.addContent(this.getView().oBusyIndicator);}},removeBusyIndicatorToTabFilter:function(i){var t=this.getSelectedTabFilter(),s;if(t&&i){if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING){s=this.getView().oNotificationsListPriority;}else{s=this.getView().oNotificationsListDate;}t.removeContent(this.getView().oBusyIndicator);t.addContent(s);}},replaceBusyIndicatorWithNotificationsList:function(){var v=this.getView(),t=v.oIconTabBar.getItems()[1];if(t.getContent()[0]===v.oBusyIndicator){t.removeContent(v.oBusyIndicator);t.addContent(v.oNotificationsListType);}},addNotificationToModel:function(n,i){var m=this.getView().getModel(),a=m.getProperty("/"+this.sCurrentSorting+"/aNotifications");a.splice(i,0,n);m.setProperty("/"+this.sCurrentSorting+"/aNotifications",a);},removeNotificationFromModel:function(n){var m=this.getView().getModel(),i,g,a,N,r={};if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING||this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING||this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING){N="/"+this.sCurrentSorting+"/aNotifications";a=m.getProperty(N);a.some(function(b,i,c){if(b.Id&&b.Id===n){r.obj=c.splice(i,1)[0];r.index=i;return true;}});m.setProperty(N,a);return r;}g=m.getProperty("/notificationsByTypeDescending");for(i=0;i<g.length;i++){a=g[i].aNotifications;if(a){if(a.length===1&&a[0].Id===n){g.splice(i,1);}else{a.some(function(b,i,c){if(b.Id&&b.Id===n){r.obj=c.splice(i,1)[0];r.index=i;return true;}});g[i].aNotifications=a;}}}this.updateGroupHeaders();m.setProperty("/notificationsByTypeDescending",g);return r;},getIndexInModelByItemId:function(n){var N,i;if(this.notificationsByTypeDescending===this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING){N=this.getView().getModel().getProperty("/"+this.sCurrentExpandedType+"/aNotifications");}else{N=this.getView().getModel().getProperty("/"+this.sCurrentSorting+"/aNotifications");}if(N===undefined||N.length===0){return 0;}for(i=0;i<N.length;i++){if(N[i].Id===n){return i;}}},cleanModel:function(){var t=this,s=this.getView().getModel().getProperty("/");if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING||this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING){this.getView().oIconTabBar.getItems()[1].removeAllContent();this.getView().oIconTabBar.getItems()[2].removeAllContent();}else if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING){this.getView().oIconTabBar.getItems()[0].removeAllContent();this.getView().oIconTabBar.getItems()[1].removeAllContent();}else{this.getView().oIconTabBar.getItems()[2].removeAllContent();this.getView().oIconTabBar.getItems()[0].removeAllContent();}jQuery.each(s,function(i,a){if(i!==t.sCurrentSorting&&i!=="notificationsByTypeDescending"){s[i]=t.getInitialSortingModelStructure();}});this.getView().getModel().setProperty("/",s);},replaceItemsInModel:function(r,n){var c=this.getItemsFromModel(this.sCurrentSorting),C=c.length,h=r.length>=n;if(C){this._oTopNotificationData=this.getTopItemOnTheScreen();}this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/hasMoreItemsInBackend",h);this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/aNotifications",r);this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/inUpdate",false);this.handleMaxReached();},setMarkReadOnModel:function(n,I){var m=this.getView().getModel(),p="/"+this.sCurrentSorting,N,d,g,i;d=m.getProperty(p);if(this.sCurrentSorting==="notificationsByTypeDescending"){for(i=0;i<d.length;i++){if(d[i].Id===this.sCurrentExpandedType){p=p+"/"+i;g=true;break;}}if(!g){return;}}p=p+"/aNotifications";N=m.getProperty(p);N.some(function(a){if(a.Id===n){a.IsRead=I;return true;}});m.setProperty(p,N);},getNumberOfItemsInScreen:function(){var i,h=this.getWindowSize();i=(h-this.oPagingConfiguration.TAB_BAR_HEIGHT)/this.oPagingConfiguration.NOTIFICATION_ITEM_HEIGHT;return Math.ceil(i);},getBasicBufferSize:function(){return Math.max(this.getNumberOfItemsInScreen()*3,this.oPagingConfiguration.MIN_NOTIFICATION_ITEMS_PER_BUFFER);},getWindowSize:function(){return jQuery(window).height();},getNumberOfItemsToFetchOnScroll:function(){var c=this.getItemsFromModel(this.sCurrentSorting).length,b=this.getBasicBufferSize();if(c>=this.iMaxNotificationItemsForDevice){return 0;}if(c+b>this.iMaxNotificationItemsForDevice){return this.iMaxNotificationItemsForDevice-c;}return b;},getNumberOfItemsToFetchOnUpdate:function(n){var b=this.getBasicBufferSize(),N=Math.ceil(n/b),r;r=N>0?N*b:b;return r>this.iMaxNotificationItemsForDevice?this.iMaxNotificationItemsForDevice:r;},getItemsFromModel:function(s){if(s===undefined){s=this.sCurrentSorting;}return this.getView().getModel().getProperty("/"+s+"/aNotifications");},getItemsOfTypeFromModel:function(t){var g=this.getGroupFromModel(t);if(g){return g.aNotifications?g.aNotifications:[];}return[];},getGroupFromModel:function(t){var g=this.getView().getModel().getProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING),G;g.some(function(a,i){if(a.Id===t){G=a;return true;}});return G;},getGroupIndexFromModel:function(t){var g=this.getView().getModel().getProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING),i;g.forEach(function(a,b){if(a.Id===t){i=b;return true;}});return i;},getItemNotificationId:function(e){var i,I;i=sap.ui.getCore().byId(e.getAttribute("Id")).getBindingContext().sPath;I=this.getView().getModel().getProperty(i+"/Id");return I;},getInitialSortingModelStructure:function(){return{hasMoreItemsInBackend:true,listMaxReached:false,aNotifications:[],inUpdate:false,moreNotificationCount:""};},getSelectedTabFilter:function(){var t;if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING||this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING){t=this.getView().oIconTabBar.getItems()[0];}else if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING){t=this.getView().oIconTabBar.getItems()[2];}else{t=this.getView().oIconTabBar.getItems()[1];}return t;},triggerRetrieveMoreDataForGroupNotifications:function(){if(!this.getModel().getProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING+"/inUpdate")){var n=this.getItemsOfTypeFromModel(this.sCurrentExpandedType),a=n?n.length:0,b=a?this.getBasicBufferSize():0,c=b*3/5,i=Math.floor(a-c),l=this.getView().oNotificationsListDate.getItems()[i],t=this.getTopOffSet();if(jQuery(l.getDomRef()).offset().top<=t){this.getNextBufferForType();}}},onExpandGroup:function(g){var l=this.getView().oNotificationsListType.getItems(),a=g.getId(),G=this.getView().getModel().getProperty(g.getBindingContextPath()),t=this;t.sCurrentExpandedType=G.Id;t.getView().getModel().setProperty(g.getBindingContextPath()+"/aNotifications",[]);t.getView().getModel().setProperty(g.getBindingContextPath()+"/hasMoreItems",true);l.forEach(function(i,b){if(i.getId()===a){t.getNextBufferForType();}else if(i.getId()!==a&&!i.getCollapsed()){i.setCollapsed(true);t.getView().getModel().setProperty(i.getBindingContextPath()+"/hasMoreItems",true);}});},notificationsUpdateCallbackForType:function(){var s=this.sCurrentExpandedType,S=this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,g=this.getGroupFromModel(s),c=g?g.aNotifications:undefined,n=0,p;if(c!==undefined){n=c.length;}this.getView().getModel().setProperty("/"+S+"/inUpdate",true);this.updateGroupHeaders();if(s){p=this.oNotificationsService.getNotificationsBufferInGroup(s,0,this.getNumberOfItemsToFetchOnUpdate(n));p.done(function(r){this.addTypeBufferToModel(s,r,true);}.bind(this));p.fail(function(r){this.getNextBufferFailHandler(r);}.bind(this));}},handleEmptyList:function(){var i=this.getItemsFromModel(this.sCurrentSorting);if(i){this.getSelectedList().toggleStyleClass("sapContrast",!i.length);this.getSelectedList().toggleStyleClass("sapContrastPlus",!i.length);}}});},false);},"sap/ushell/components/shell/Notifications/Notifications.view.js":function(){sap.ui.define(['sap/m/NotificationListItem','sap/m/BusyIndicator','sap/m/Button','sap/m/NotificationListGroup','sap/m/List','sap/m/IconTabFilter','sap/m/IconTabBar','sap/m/Text','sap/m/VBox','sap/m/CustomListItem'],function(N,B,a,b,L,I,c,T,V,C){"use strict";sap.ui.jsview("sap.ushell.components.shell.Notifications.Notifications",{createContent:function(o){var t=this;this.oBusyIndicator=new B('notificationsByTypeBusyIndicator',{size:"1rem"});this.oPreviousTabKey="sapUshellNotificationIconTabByDate";this.oPreviousByDateSorting=undefined;var _=function(){var k=this.oIconTabBar.getSelectedKey();var f=this.oIconTabBar.getItems();var s=0;f.forEach(function(g,h){if(g.getKey()===k){s=h;}});f[s].focus();}.bind(this);this.oActionListItemTemplate=new a({text:"{ActionText}",type:{parts:["Nature"],formatter:function(n){switch(n){case"POSITIVE":return"Accept";case"NEGATIVE":return"Reject";default:return"Default";}}},press:function(E){_();t.actionButtonPressHandler(E);}});this.removeTabIndexFromList=function(O){var l=O.$().children().get(1);if(l){l.removeAttribute("tabindex");}};this.actionButtonPressHandler=function(E){var n=E.getSource().getBindingContext().getPath(),f=this.getModel().getProperty(n),p=n.split("/"),g=t.oIconTabBar.getSelectedKey(),P=g==='sapUshellNotificationIconTabByType'?"/"+p[1]+"/"+p[2]+"/"+p[3]+"/"+p[4]:"/"+p[1]+"/"+p[2]+"/"+p[3],h=this.getModel().getProperty(P),s=h.Id;_();this.oPressActionEventPath=n;this.getModel().setProperty(P+"/Busy",true);o.executeAction(s,f.ActionId).done(function(r){if(r&&r.isSucessfull){sap.ui.require(['sap/m/MessageToast'],function(M){if(r.message&&r.message.length){M.show(r.message,{duration:4000});}else{var A=this.oPressActionEventPath,j=this.getModel().getProperty(A),k=j.ActionText;M.show(sap.ushell.resources.i18n.getText("ActionAppliedToNotification",k),{duration:4000});}}.bind(this));if(r.DeleteOnReturn!==false){o.removeNotificationFromModel(s);sap.ushell.Container.getService('Notifications')._addDismissNotifications(s);o.cleanModel();}}else if(r){sap.ushell.Container.getService('Message').error(r.message);}else{sap.ushell.Container.getService('Message').error(sap.ushell.resources.i18n.getText('notificationsFailedExecuteAction'));}this.getModel().setProperty(P+"/Busy",false);}.bind(this)).fail(function(){this.getModel().setProperty(P+"/Busy",false);sap.ushell.Container.getService('Message').error(sap.ushell.resources.i18n.getText('notificationsFailedExecuteAction'));}.bind(this));};this.oActionGroupItemTemplate=new a({text:"{GroupActionText}",type:{parts:["Nature"],formatter:function(n){switch(n){case"POSITIVE":return"Accept";case"NEGATIVE":return"Reject";default:return"Default";}}},press:function(E){var n=this.getBindingContext().getPath(),f=this.getModel().getProperty(n),p=n.split("/"),P="/"+p[1]+"/"+p[2],g=this.getModel().getProperty(P),h=[];_();if(g.aNotifications){g.aNotifications.forEach(function(j,k){h.push(j.Id);this.getModel().setProperty(P+"/Busy",true);}.bind(this));}this.getModel().setProperty(n+"/Busy",true);o.executeBulkAction(h,f.ActionId,this.getProperty("text"),g,n,P);}});this.addStyleClass('sapUshellNotificationsView');this.oNotificationListItemTemplate=new N({press:function(E){var f=this.getBindingContext(),m=f.sPath,M=this.getModel().getProperty(m),s=M.NavigationTargetObject,A=M.NavigationTargetAction,p=M.NavigationTargetParams,n=M.Id;o.onListItemPress.call(o,n,s,A,p);},datetime:{path:"CreatedAt",formatter:sap.ushell.utils.formatDate.bind(o)},description:"{SubTitle}",title:{parts:["SensitiveText","Text"],formatter:function(s,f){return s||f;}},buttons:{path:"Actions",templateShareable:true,sorter:new sap.ui.model.Sorter('Nature',true),template:this.oActionListItemTemplate},unread:{parts:["IsRead"],formatter:function(f){return!f;}},close:function(E){_();var n=this.getBindingContext().getPath(),f=this.getModel().getProperty(n),s=f.Id;o.dismissNotification(s);},busy:{parts:["Busy"],formatter:function(f){if(f){return f;}return false;}},priority:{parts:["Priority"],formatter:function(p){if(p){p=p.charAt(0)+p.substr(1).toLowerCase();return sap.ui.core.Priority[p];}}}}).addStyleClass("sapUshellNotificationsListItem").addStyleClass('sapContrastPlus').addStyleClass('sapContrast');this.oNotificationGroupTemplate=new b({title:"{GroupHeaderText}",collapsed:"{Collapsed}",showEmptyGroup:true,enableCollapseButtonWhenEmpty:true,datetime:{path:"CreatedAt",formatter:sap.ushell.utils.formatDate.bind(o)},buttons:{path:"Actions",templateShareable:true,sorter:new sap.ui.model.Sorter('Nature',true),template:this.oActionGroupItemTemplate},items:{path:"aNotifications",template:this.oNotificationListItemTemplate,templateShareable:true},onCollapse:function(E){var g=E.getSource(),p=g.getBindingContext().getPath();if(!g.getCollapsed()){t.getModel().setProperty(p+"/Busy",true);t.expandedGroupIndex=p.substring(p.lastIndexOf("/")+1);o.onExpandGroup(g);}},close:function(E){var n=this.getBindingContext().getPath(),p=n.split("/"),P="/"+p[1]+"/"+p[2],f=this.getModel().getProperty(P),g=[];f.aNotifications.forEach(function(h,j){g.push(h.Id);});o.dismissBulkNotifications(g,f);},autoPriority:false,priority:{parts:["Priority"],formatter:function(p){if(p){p=p.charAt(0)+p.substr(1).toLowerCase();return sap.ui.core.Priority[p];}}},busy:{parts:["Busy"],formatter:function(f){if(f){return f;}return false;}}});this.oNotificationsListDate=new L({id:"sapUshellNotificationsListDate",mode:sap.m.ListMode.None,noDataText:sap.ushell.resources.i18n.getText('noNotificationsMsg'),items:{path:"/notificationsByDateDescending/aNotifications",template:this.oNotificationListItemTemplate,templateShareable:true},growing:true,growingThreshold:400,growingScrollToLoad:true}).addStyleClass("sapUshellNotificationsList");this.oNotificationsListDate.addEventDelegate({onAfterRendering:function(){o.handleEmptyList();this.oNotificationsListDate.$().parent().parent().scroll(this._triggerRetrieveMoreData.bind(t));if(o._oTopNotificationData){o.scrollToItem(o._oTopNotificationData);}this.oNotificationsListDate.addStyleClass('sapContrast sapContrastPlus');this.removeTabIndexFromList(this.oNotificationsListDate);}.bind(this)});this.oNotificationsListPriority=new L({id:"sapUshellNotificationsListPriority",mode:sap.m.ListMode.None,noDataText:sap.ushell.resources.i18n.getText('noNotificationsMsg'),items:{path:"/notificationsByPriorityDescending/aNotifications",template:this.oNotificationListItemTemplate,templateShareable:true},growing:true,growingThreshold:400,growingScrollToLoad:true}).addStyleClass("sapUshellNotificationsList");this.oNotificationsListPriority.addEventDelegate({onAfterRendering:function(){o.handleEmptyList();this.oNotificationsListPriority.$().parent().parent().scroll(this._triggerRetrieveMoreData.bind(t));if(o._oTopNotificationData){o.scrollToItem(o._oTopNotificationData);}this.oNotificationsListPriority.addStyleClass('sapContrast sapContrastPlus');this.removeTabIndexFromList(this.oNotificationsListPriority);}.bind(this)});this.triggerRetrieveMoreData=function(p){if(!this.getModel().getProperty("/"+p+"/inUpdate")){var n=this.getController().getItemsFromModel(p),f=n?n.length:0,g=f?this.getController().getBasicBufferSize():0,h=g*2/3,j=Math.floor(f-h),l=p==="notificationsByPriorityDescending"?this.oNotificationsListPriority.getItems()[j]:this.oNotificationsListDate.getItems()[j],k=this.getController().getTopOffSet();if(l&&l.getDomRef()&&jQuery(l.getDomRef()).offset().top<=k){this.getController().getNextBuffer(p);}}};this.triggerRetrieveMoreDataForExpandedGroup=function(){if(!this.getModel().getProperty("/notificationsByTypeDescending/inUpdate")){var g=this.getModel().getProperty("/notificationsByTypeDescending"),n=g.length,f=this.getModel().getProperty("/notificationsByTypeDescending")[this.expandedGroupIndex].aNotifications.length,h=f+n,j=h?this.getController().getBasicBufferSize():0,k=j*2/3,l=Math.floor(h-k),m=this.oNotificationsListType.getItems()[this.expandedGroupIndex].getItems()[l],p=this.getController().getTopOffSet();if(m&&m.getDomRef()&&jQuery(m.getDomRef()).offset().top<=p){o.getNextBufferForType();}}};this._triggerRetrieveMoreData=function(){this.triggerRetrieveMoreData(o.sCurrentSorting);};this.oNotificationsListType=new L({id:"sapUshellNotificationsListType",mode:sap.m.ListMode.SingleSelect,noDataText:sap.ushell.resources.i18n.getText('noNotificationsMsg'),items:{path:"/notificationsByTypeDescending",template:t.oNotificationGroupTemplate,templateShareable:true}}).addStyleClass("sapUshellNotificationsList").addStyleClass('sapContrastPlus').addStyleClass('sapContrast');this.oNotificationsListType.addEventDelegate({onAfterRendering:function(){this.oNotificationsListType.$().parent().parent().scroll(this.triggerRetrieveMoreDataForExpandedGroup.bind(t));this.removeTabIndexFromList(this.oNotificationsListType);}.bind(this)});var i=new I({id:"sapUshellNotificationIconTabByDate",key:"sapUshellNotificationIconTabByDate",text:sap.ushell.resources.i18n.getText('notificationsSortByDate'),tooltip:sap.ushell.resources.i18n.getText('notificationsSortByDateDescendingTooltip')});var d=new I({id:"sapUshellNotificationIconTabByType",key:"sapUshellNotificationIconTabByType",text:sap.ushell.resources.i18n.getText('notificationsSortByType'),tooltip:sap.ushell.resources.i18n.getText('notificationsSortByTypeTooltip'),content:this.oNotificationsListType});var e=new I({id:"sapUshellNotificationIconTabByPrio",key:"sapUshellNotificationIconTabByPrio",text:sap.ushell.resources.i18n.getText('notificationsSortByPriority'),tooltip:sap.ushell.resources.i18n.getText('notificationsSortByPriorityTooltip')});this.oIconTabBar=new c('notificationIconTabBar',{backgroundDesign:sap.m.BackgroundDesign.Transparent,expandable:false,selectedKey:"sapUshellNotificationIconTabByDate",items:[i,d,e],select:function(f){var k=f.getParameter("key"),g=f.getParameter("item");if(k==="sapUshellNotificationIconTabByDate"){if(((t.oPreviousTabKey==="sapUshellNotificationIconTabByDate")&&((t.oPreviousByDateSorting===t.oController.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING)||t.oPreviousByDateSorting===undefined))||((t.oPreviousTabKey!=="sapUshellNotificationIconTabByDate")&&(t.oPreviousByDateSorting===t.oController.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING))){t.oController.sCurrentSorting=t.oController.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING;g.setTooltip(sap.ushell.resources.i18n.getText('notificationsSortByDateAscendingTooltip'));t.oNotificationsListDate.bindItems("/notificationsByDateAscending/aNotifications",t.oNotificationListItemTemplate);if(o.getItemsFromModel(o.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING).length===0){o.getNextBuffer(o.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING);}t.oPreviousByDateSorting=t.oController.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING;}else{t.oController.sCurrentSorting=t.oController.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING;g.setTooltip(sap.ushell.resources.i18n.getText('notificationsSortByDateDescendingTooltip'));t.oNotificationsListDate.bindItems("/notificationsByDateDescending/aNotifications",t.oNotificationListItemTemplate);if(o.getItemsFromModel(o.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING).length===0){o.getNextBuffer(o.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING);}t.oPreviousByDateSorting=t.oController.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING;}t.oPreviousTabKey="sapUshellNotificationIconTabByDate";}else if(k==="sapUshellNotificationIconTabByType"&&t.oPreviousTabKey!=="sapUshellNotificationIconTabByType"){t.oController.sCurrentSorting=t.oController.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING;t.getController().reloadGroupHeaders();g.removeAllContent();g.addContent(t.oBusyIndicator);t.oIconTabBar.addStyleClass('sapUshellNotificationIconTabByTypeWithBusyIndicator');t.oPreviousTabKey="sapUshellNotificationIconTabByType";}else{t.oController.sCurrentSorting=t.oController.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING;if(o.getItemsFromModel(o.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING).length===0){o.getNextBuffer(o.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING);}t.oPreviousTabKey="sapUshellNotificationIconTabByPrio";}t.oPreviousTabKey=k;}}).addStyleClass('sapUshellNotificationTabBar');this.oIconTabBar.addEventDelegate({onsaptabprevious:function(E){var O=E.originalEvent,s=O.srcElement,f=s.classList,g;g=jQuery.inArray('sapMITBFilter',f)>-1;if(g===true){E.preventDefault();sap.ushell.renderers.fiori2.AccessKeysHandler.setIsFocusHandledByAnotherHandler(true);sap.ushell.renderers.fiori2.AccessKeysHandler.sendFocusBackToShell(E);}},onAfterRendering:function(){var f=sap.ui.getCore().byId('notificationIconTabBar--header');if(f){f.addStyleClass('sapContrastPlus');f.addStyleClass('sapUshellTabBarHeader');}}});return[this.oIconTabBar];},getMoreCircle:function(t){var m=new T({text:sap.ushell.resources.i18n.getText('moreNotifications')}),n=new T({text:""}).addStyleClass("sapUshellNotificationsMoreCircleCount"),M=new V({items:[n,m],alignItems:sap.m.FlexAlignItems.Center}).addStyleClass("sapUshellNotificationsMoreCircle"),o=new T({text:sap.ushell.resources.i18n.getText('moreNotificationsAvailable_message'),textAlign:"Center"}).addStyleClass("sapUshellNotificationsMoreHelpingText"),d=new T({text:sap.ushell.resources.i18n.getText('processNotifications_message'),textAlign:"Center"}).addStyleClass("sapUshellNotificationsMoreHelpingText"),v=new V({items:[M,o,d]}).addStyleClass("sapUshellNotificationsMoreVBox"),l=new C({type:sap.m.ListType.Inactive,content:v}).addStyleClass("sapUshellNotificationsMoreListItem").addStyleClass('sapContrastPlus');n.setModel(this.getModel());n.bindText("/"+t+"/moreNotificationCount");this.oMoreListItem=l;return l;},getControllerName:function(){return"sap.ushell.components.shell.Notifications.Notifications";}});},false);},"sap/ushell/components/shell/Notifications/Settings.controller.js":function(){sap.ui.define(function(){"use strict";sap.ui.controller("sap.ushell.components.shell.Notifications.Settings",{onInit:function(){var t=this,s=sap.ushell.Container.getService("Notifications").readSettings(),m=new sap.ui.model.json.JSONModel(),v,n,r,d;m.setProperty("/aDitryRowsIndicator",[]);m.setProperty("/rows",[]);m.setProperty("/originalRows",[]);s.done(function(R){r=JSON.parse(R);m.setProperty("/rows",r.value);d=JSON.parse(JSON.stringify(r.value));m.setProperty("/originalRows",d);});s.fail(function(){n=t.getView().getNoDataUI();t.getView().removeAllContent();t.getView().addContent(n);});this._handleSwitchFlagsDataInitialization(m);v=this.getView();v.setModel(m);},onExit:function(){},onBeforeRendering:function(){},onAfterRendering:function(){var o=this.getView().getModel().getProperty("/flags"),r=this.getView().getModel().getProperty("/rows"),d;if(r!==undefined){d=JSON.parse(JSON.stringify(r));this.getView().getModel().setProperty("/originalRows",d);}this.getView().getModel().setProperty("/originalFlags/previewNotificationEnabled",o.previewNotificationEnabled);this.getView().getModel().setProperty("/originalFlags/highPriorityBannerEnabled",o.highPriorityBannerEnabled);this.getView().getModel().setProperty("/aDitryRowsIndicator",[]);},getContent:function(){var d=new jQuery.Deferred();d.resolve(this.getView());return d.promise();},getValue:function(){var d=new jQuery.Deferred();d.resolve(" ");return d.promise();},onCancel:function(){var o=this.getView().getModel().getProperty("/originalFlags"),O=this.getView().getModel().getProperty("/originalRows"),d=JSON.parse(JSON.stringify(O));this.getView().getModel().setProperty("/flags/previewNotificationEnabled",o.previewNotificationEnabled);this.getView().getModel().setProperty("/flags/highPriorityBannerEnabled",o.highPriorityBannerEnabled);this.getView().getModel().setProperty("/rows",d);this.getView().getModel().setProperty("/originalFlags",{});this.getView().getModel().setProperty("/originalRows",[]);this.getView().getModel().setProperty("/aDitryRowsIndicator",[]);},onSave:function(){var d=new jQuery.Deferred(),r=this.getView().getModel().getProperty("/rows"),o=this.getView().getModel().getProperty("/originalRows"),t,T,i,D=this.getView().getModel().getProperty("/aDitryRowsIndicator");d.resolve();this._handleSwitchFlagsSave();for(i=0;i<r.length;i++){if(D[i]&&D[i]===true){t=r[i];T=o[i];if(!this._identicalRows(t,T)){sap.ushell.Container.getService("Notifications").saveSettingsEntry(t);}}}this.getView().getModel().setProperty("/aDitryRowsIndicator",[]);return d.promise();},setControlDirtyFlag:function(){var c=this.getBindingContext().sPath,i=c.substring(c.lastIndexOf("/")+1,c.length),o=this.getModel().getProperty("/aDitryRowsIndicator");if(o!==undefined){this.getModel().setProperty("/aDitryRowsIndicator/"+i,true);}},_handleSwitchFlagsDataInitialization:function(m){var s=sap.ushell.Container.getService("Notifications").getUserSettingsFlags(),M=sap.ushell.Container.getService("Notifications")._getNotificationSettingsMobileSupport(),e=sap.ushell.Container.getService("Notifications")._getNotificationSettingsEmailSupport(),p=sap.ushell.Container.getService("Notifications")._getNotificationSettingsPreviewVisible();s.done(function(S){m.setProperty("/flags",{});m.setProperty("/flags/previewNotificationEnabled",S.previewNotificationEnabled);m.setProperty("/flags/previewNotificationVisible",p);m.setProperty("/flags/highPriorityBannerEnabled",S.highPriorityBannerEnabled);m.setProperty("/flags/mobileNotificationsEnabled",M);m.setProperty("/flags/emailNotificationsEnabled",e);m.setProperty("/originalFlags",{});m.setProperty("/originalFlags/previewNotificationEnabled",S.previewNotificationEnabled);m.setProperty("/originalFlags/highPriorityBannerEnabled",S.highPriorityBannerEnabled);});},_handleSwitchFlagsSave:function(){var p=this.getView().getModel().getProperty("/flags/previewNotificationEnabled"),h=this.getView().getModel().getProperty("/flags/highPriorityBannerEnabled"),o=this.getView().getModel().getProperty("/originalFlags/previewNotificationEnabled"),O=this.getView().getModel().getProperty("/originalFlags/highPriorityBannerEnabled");if((o!==p)||(O!==h)){sap.ushell.Container.getService("Notifications").setUserSettingsFlags({previewNotificationEnabled:p,highPriorityBannerEnabled:h});if(p!==o){sap.ui.getCore().getEventBus().publish("sap.ushell.services.Notifications","enablePreviewNotificationChanged",{bPreviewEnabled:p});}this.getView().getModel().setProperty("/originalFlags/previewNotificationEnabled",p);this.getView().getModel().setProperty("/originalFlags/highPriorityBannerEnabled",h);}},_identicalRows:function(r,a){if((r.NotificationTypeId===a.NotificationTypeId)&&(r.PriorityDefault===a.PriorityDefault)&&(r.DoNotDeliver===a.DoNotDeliver)&&(r.DoNotDeliverMob===a.DoNotDeliverMob)&&(r.DoNotDeliverEmail===a.DoNotDeliverEmail)){return true;}return false;}});},false);},"sap/ushell/components/shell/Notifications/Settings.view.js":function(){sap.ui.define(["sap/m/Table","sap/m/Column","sap/m/CheckBox","sap/m/Switch","sap/m/Text","sap/m/Label","sap/m/VBox","sap/m/HBox","sap/m/FlexBox","sap/ui/core/Icon","sap/m/ColumnListItem","sap/ui/core/TextAlign","sap/m/BackgroundDesign","sap/m/ListSeparators","sap/ui/model/Sorter"],function(T,C,a,S,b,L,V,H,F,I,c,d,B,e,f){"use strict";sap.ui.jsview("sap.ushell.components.shell.Notifications.Settings",{createContent:function(o){var t=this,n,g,s,v,h,r=sap.ushell.resources.i18n;n=new T("notificationSettingsTable",{backgroundDesign:B.Transparent,showSeparators:e.All,fixedLayout:false,columns:[new C({header:new b({text:r.getText("notificationType_column"),tooltip:r.getText("notificationType_columnTooltip")}),vAlign:"Middle",hAlign:"Left"}),new C({header:new b({text:r.getText("iOSNotification_column"),tooltip:r.getText("iOSNotification_columnTooltip")}),visible:"{/flags/mobileNotificationsEnabled}",minScreenWidth:"Tablet",demandPopin:true,vAlign:"Middle",hAlign:"Left"}),new C({header:new b({text:r.getText("eMailFld"),tooltip:r.getText("email_columnTooltip")}),visible:"{/flags/emailNotificationsEnabled}",minScreenWidth:"Tablet",demandPopin:true,vAlign:"Middle",hAlign:"Left"}),new C({header:new b({text:r.getText("highNotificationsBanner_column"),tooltip:r.getText("highNotificationsBanner_columnTooltip")}),minScreenWidth:"Tablet",demandPopin:true,hAlign:"Left"}),new C({header:new b({text:r.getText("Notifications_Settings_Show_Type_column"),tooltip:r.getText("notificationTypeEnable_columnTooltip")}),vAlign:"Middle",hAlign:"Left"})]});g=new c({cells:[new L({text:"{NotificationTypeDesc}"}),new a({selected:{parts:["DoNotDeliverMob"],formatter:function(D){return!D;}},select:function(E){t.getController().setControlDirtyFlag.apply(this);var p=E.getSource().getBindingContext().sPath;t.getModel().setProperty(p+"/DoNotDeliverMob",!E.mParameters.selected);}}),new a({visible:{parts:["IsEmailEnabled","IsEmailIdMaintained","DoNotDeliver"],formatter:function(E,i,D){return E&&i&&!D;}},selected:{path:"DoNotDeliverEmail",formatter:function(D){return!D;}},select:function(E){t.getController().setControlDirtyFlag.apply(this);var p=E.getSource().getBindingContext().sPath;t.getModel().setProperty(p+"/DoNotDeliverEmail",!E.mParameters.selected);}}),new a({select:function(E){t.getController().setControlDirtyFlag.apply(this);var p=E.getSource().getBindingContext().sPath;if(E.mParameters.selected===true){t.getModel().setProperty(p+"/PriorityDefault","40-HIGH");}else{t.getModel().setProperty(p+"/PriorityDefault","");}},selected:{parts:["PriorityDefault"],formatter:function(p){t.getController().setControlDirtyFlag.apply(this);if(p==="40-HIGH"){return true;}return false;}}}),new S({state:{parts:["DoNotDeliver"],formatter:function(D){return!D;}},customTextOn:" ",customTextOff:" ",change:function(E){var N=E.getParameter("state"),p=E.getSource().getBindingContext().sPath;t.getModel().setProperty(p+"/DoNotDeliver",!N);t.getController().setControlDirtyFlag.apply(this);}})]});n.bindAggregation("items",{path:"/rows",template:g,sorter:new f("NotificationTypeDesc")});v=new V();s=this.createSwitchControlBar();h=new V();h.addStyleClass("sapContrastPlus");h.addItem(s);v.addItem(h);v.addItem(n);return[v];},createSwitchControlBar:function(){var D,o,g,p,E,h,s,r=sap.ushell.resources.i18n,i=sap.ui.Device.system,j=i.desktop||i.tablet||i.combi;s=new F('notificationSettingsSwitchBar');o=new L("doNotDisturbLabel",{text:r.getText("Show_High_Priority_Alerts_title")});D=new S("doNotDisturbSwitch",{tooltip:r.getText("showAlertsForHighNotifications_tooltip"),state:"{/flags/highPriorityBannerEnabled}",customTextOn:r.getText("Yes"),customTextOff:r.getText("No")}).addAriaLabelledBy(o);g=new H("notificationDoNotDisturbHBox",{items:[D,o]});s.addItem(g);if(j===true){E=new L("enablePreviewLabel",{text:r.getText("Show_Preview_in_Home_Page_title"),visible:"{/flags/previewNotificationVisible}"});p=new S("enablePreviewSwitch",{tooltip:r.getText("showNotificationsPreview_tooltip"),state:"{/flags/previewNotificationEnabled}",customTextOn:r.getText("Yes"),customTextOff:r.getText("No"),visible:"{/flags/previewNotificationVisible}"}).addAriaLabelledBy(E);h=new F({items:[p,E]});s.addItem(h);}return s;},getNoDataUI:function(){var n,N,o,g,r=sap.ushell.resources.i18n;if(n===undefined){N=new I("notificationSettingsNoDataIcon",{size:"5rem",src:"sap-icon://message-information"});o=new b("notificationSettingsNoDataTextHeader",{text:r.getText("noNotificationTypesEnabledHeader_message")}).setTextAlign(d.Center);g=new b("notificationSettingsNoDataText",{text:r.getText("noNotificationTypesEnabled_message")}).setTextAlign(d.Center);n=new V("notificationSettingsNoDataInnerBox",{items:[N,o,g]});}return n;},getControllerName:function(){return"sap.ushell.components.shell.Notifications.Settings";}});},false);},"sap/ushell/components/shell/Notifications/fiori3/Component.js":function(){sap.ui.define(["sap/ushell/resources","sap/ui/core/UIComponent","sap/ushell/utils","sap/ushell/EventHub","sap/ui/Device","sap/ushell/ui/shell/OverflowPopover"],function(r,U,u,E,D,P){"use strict";function g(){return sap.ui.getCore().byId("NotificationsCountButton");}return U.extend("sap.ushell.components.shell.Notifications.fiori3.Component",{metadata:{version:"${version}",library:"sap.ushell.components.shell.Notifications",dependencies:{libs:["sap.m"]}},createContent:function(){this._aTimeouts=[];this.oRenderer=sap.ushell.Container.getRenderer("fiori2");this.oNotificationsService=sap.ushell.Container.getService("Notifications");sap.ui.getCore().getEventBus().subscribe("sap.ushell.services.Notifications","onNewNotifications",this._handleAlerts,this);if(this.oNotificationsService.isEnabled()===true){this.oRenderer.shellCtrl.getModel().setProperty("/enableNotifications",true);this.oNotificationsService.init();if(this.oRenderer.getShellConfig().enableNotificationsUI===true){this.oRenderer.shellCtrl.getModel().setProperty("/enableNotificationsUI",true);this.oNotificationsService.registerDependencyNotificationsUpdateCallback(this._updateCount.bind(this),true);}}var n=g();n.applySettings({icon:sap.ui.core.IconPool.getIconURI("bell"),floatingNumber:"{/notificationsCount}",visible:"{/enableNotifications}",selected:false,enabled:true,press:this._toggleNotifications.bind(this),tooltip:r.i18n.getText("NotificationToggleButtonExpanded")},true,true).removeStyleClass("sapUshellPlaceHolders");n.addEventDelegate({onAfterRendering:function(){var c=this.getDisplayFloatingNumber();if(c>0){this.$().attr("aria-label",r.i18n.getText("NotificationToggleButtonCollapsed",c));}else{this.$().attr("aria-label",r.i18n.getText("NotificationToggleButtonCollapsedNoNotifications"));}}.bind(n)});if(this.oRenderer.oShellModel.getModel().getProperty("/enableNotificationsUI")===true){this.oRenderer.addHeaderEndItem(["NotificationsCountButton"],false,["home","app","minimal"],true);}if(D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name==="Phone"){this.oRenderer.getShellController().handleEndItemsOverflow({name:"Phone",showOverFlowBtn:true});}E.on("showNotifications").do(this._toggleNotifications.bind(this));},_handleAlerts:function(c,e,n){(n||[]).forEach(this.handleNotification.bind(this));},handleNotification:function(n){var a=this.oRenderer.addRightFloatingContainerItem({press:function(){this.oPopover.close();if(window.hasher.getHash()!==n.NavigationTargetObject+"-"+n.NavigationTargetAction){u.toExternalWithParameters(n.NavigationTargetObject,n.NavigationTargetAction,n.NavigationTargetParams);}this.oNotificationsService.markRead(n.Id);},datetime:r.i18n.getText("notification_arrival_time_now"),title:n.SensitiveText?n.SensitiveText:n.Text,description:n.SubTitle,unread:n.IsRead,priority:"High",hideShowMoreButton:true},true,true);this.oRenderer.showRightFloatingContainer(true);var t=setTimeout(function(){this.oRenderer.removeRightFloatingContainerItem(a.getId(),true);}.bind(this),3500);this._aTimeouts.push(t);},_updateCount:function(){var m=this.oRenderer.oShellModel.getModel();this.oNotificationsService.getUnseenNotificationsCount().done(function(n){m.setProperty("/notificationsCount",parseInt(n,10));}).fail(function(d){jQuery.sap.log.error("Notifications - call to notificationsService.getCount failed: ",d);});},_getPopover:function(){if(!this.oPopover){var n=sap.ui.view("notificationsView",{viewName:"sap.ushell.components.shell.Notifications.fiori3.Notifications",type:"XML",viewData:{}});n.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"role",value:"region",writeToDom:true}));n.addCustomData(new sap.ushell.ui.launchpad.AccessibilityCustomData({key:"aria-label",value:r.i18n.getText("NotificationToggleButtonExpanded"),writeToDom:true}));this.oPopover=new P("shellNotificationsPopover",{showHeader:false,placement:sap.m.PlacementType.Bottom,showArrow:true,content:n,beforeClose:function(e){e.getSource().getContent()[0].invalidate();this._resetCount();}.bind(this)}).addStyleClass("sapUshellNotificationsPopup sapUiSizeCompact");}return this.oPopover;},_toggleNotifications:function(s){var p=this._getPopover();var S=g();if(!S.$().width()){S=sap.ui.getCore().byId("endItemsOverflowBtn");}if(p.isOpen()){p.close();}else if(s!==false){this._resetCount();p.setContentWidth(jQuery("body").width()>=600?"31.1rem":undefined);p.openBy(S);}},_resetCount:function(){sap.ushell.Container.getRenderer("fiori2").oShellModel.getModel().setProperty("/notificationsCount",0);sap.ushell.Container.getService("Notifications").notificationsSeen();},exit:function(){sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.services.Notifications","onNewNotifications",this._handleAlerts,this);if(this.oNotificationsService.isEnabled()===true){this.oNotificationsService.destroy();}this.oNotificationsService=null;this.oRenderer=null;if(this.oPopover){this.oPopover.destroy();this.oPopover=null;}this._aTimeouts.forEach(window.clearTimeout);}});});},"sap/ushell/components/shell/Notifications/fiori3/Notifications.controller.js":function(){sap.ui.define(['sap/ushell/utils','sap/ushell/resources','sap/ushell/renderers/fiori2/AccessKeysHandler','sap/m/Text','sap/m/VBox','sap/m/CustomListItem'],function(u,r,A,T,V,C){"use strict";sap.ui.controller("sap.ushell.components.shell.Notifications.fiori3.Notifications",{oPagingConfiguration:{MAX_NOTIFICATION_ITEMS_DESKTOP:400,MAX_NOTIFICATION_ITEMS_MOBILE:100,MIN_NOTIFICATION_ITEMS_PER_BUFFER:15,NOTIFICATION_ITEM_HEIGHT:(sap.ui.Device.system.phone||sap.ui.Device.system.tablet)?130:100,TAB_BAR_HEIGHT:100},onInit:function(){var i={};this.iMaxNotificationItemsForDevice=sap.ui.Device.system.desktop?this.oPagingConfiguration.MAX_NOTIFICATION_ITEMS_DESKTOP:this.oPagingConfiguration.MAX_NOTIFICATION_ITEMS_MOBILE;this.oNotificationsService=sap.ushell.Container.getService("Notifications");this.oSortingType=this.oNotificationsService.getOperationEnum();i[this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING]=this.getInitialSortingModelStructure();i[this.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING]=this.getInitialSortingModelStructure();i[this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING]=this.getInitialSortingModelStructure();i[this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING]={};this.sCurrentSorting=this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING;this.oPreviousByDateSorting=this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING;this.oPreviousTabKey="sapUshellNotificationIconTabByDate";this.sCurrentExpandedType=undefined;var m=new sap.ui.model.json.JSONModel(i);m.setSizeLimit(1500);this.getView().setModel(m);this.getView().setModel(r.i18nModel,"i18n");var I=this.getView().byId("notificationIconTabBar");if(I){I.addEventDelegate({onsaptabprevious:function(e){var o=e.originalEvent,s=o.srcElement,c=s.classList,b;b=jQuery.inArray('sapMITBFilter',c)>-1;if(b===true){e.preventDefault();A.setIsFocusHandledByAnotherHandler(true);A.sendFocusBackToShell(e);}}});}this.getNextBuffer();this._oTopNotificationData=undefined;},onAfterRendering:function(){this.removeTabIndexFromList(this.sCurrentSorting);var t=this.getView().byId('notificationIconTabBar--header');if(t){t.toggleStyleClass('sapContrastPlus',true);t.toggleStyleClass('sapUshellTabBarHeader',true);}if(this.sCurrentSorting!==this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING){if(this._oTopNotificationData){this.scrollToItem(this._oTopNotificationData);}}},shouldFetchMoreNotifications:function(){var h=this.getView().getModel().getProperty("/"+this.sCurrentSorting+"/hasMoreItemsInBackend"),l=this.getView().getModel().getProperty("/"+this.sCurrentSorting+"/listMaxReached");return h&&!l;},getNextBuffer:function(){var c=this.sCurrentSorting,a=this.getItemsFromModel(c),n,p,N;if(!this.shouldFetchMoreNotifications()){return;}N=this.getNumberOfItemsToFetchOnScroll(c);if(N===0){this.getView().getModel().setProperty("/"+c+"/hasMoreItems",false);return;}if(a!==undefined){n=a.length;}if(n===0){this.addBusyIndicatorToTabFilter(c);}this.getView().getModel().setProperty("/"+c+"/inUpdate",true);p=this.oNotificationsService.getNotificationsBufferBySortingType(c,n,N);p.done(function(R){var d=this.oNotificationsService._getNotificationSettingsAvalability();if(d.state()=="pending"){this.oNotificationsService._userSettingInitialization();}this.addBufferToModel(c,R);}.bind(this));p.fail(function(R){if(n===0){this.removeBusyIndicatorToTabFilter(c);this.handleError();}}.bind(this));},getNextBufferForType:function(){var s=this.sCurrentExpandedType,S=this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,g=this.getGroupFromModel(s),c=g?g.aNotifications:undefined,n=0,p,h=g?g.hasMoreItems:true;if(!h){return;}if(c!==undefined){n=c.length;}this.getView().getModel().setProperty("/"+S+"/inUpdate",true);p=this.oNotificationsService.getNotificationsBufferInGroup(s,n,this.iMaxNotificationItemsForDevice);p.done(function(R){this.addTypeBufferToModel(s,R,false);}.bind(this));p.fail(function(R){this.getNextBufferFailHandler(S);}.bind(this));},addBufferToModel:function(s,R){var c=this.getItemsFromModel(s),i=c.length,m,h=R.length>=this.getNumberOfItemsToFetchOnScroll(s);this._oTopNotificationData=undefined;if(!R){this.getView().getModel().setProperty("/"+s+"/hasMoreItemsInBackend",false);return;}this.getView().getModel().setProperty("/"+s+"/hasMoreItemsInBackend",h);m=c.concat(R);this.getView().getModel().setProperty("/"+s+"/aNotifications",m);this.getView().getModel().setProperty("/"+s+"/inUpdate",false);if(m.length>=this.iMaxNotificationItemsForDevice){this.handleMaxReached(s);}this.handleListCSSClass(s,!m.length);if(i===0){this.removeBusyIndicatorToTabFilter(s);}},addTypeBufferToModel:function(t,R,o){var g=this.getGroupFromModel(t),G=this.getGroupIndexFromModel(t),a=this.getView().getModel().getProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING),m;if(!R){return;}if(R.length<this.getBasicBufferSize()){g.hasMoreItems=false;}if(!g.aNotifications||o){g.aNotifications=[];}m=g.aNotifications.concat(R);a[G].aNotifications=m;a[G].Busy=false;this.getView().getModel().setProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,a);this.getView().getModel().setProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING+"/inUpdate",false);},keydownHandler:function(k){var j,n,c;if(k.keyCode===jQuery.sap.KeyCodes.DELETE){j=jQuery(document.activeElement);if(j.hasClass('sapUshellNotificationsListItem')){n=j.next();c=j.find(".sapMNLB-CloseButton")[0];sap.ui.getCore().byId(c.id).firePress();if(n){n.focus();}}}},notificationsUpdateCallback:function(d){var t=this,c=this.sCurrentSorting,a,n,N;if(c===this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING){this.notificationsUpdateCallbackForType();d.resolve();return;}a=this.getItemsFromModel(c);if(a!==undefined){n=a.length;}this.cleanModel();N=this.getNumberOfItemsToFetchOnUpdate(n);this.oNotificationsService.getNotificationsBufferBySortingType(c,0,N).done(function(b){if(!b){return;}d.resolve();t.replaceItemsInModel(c,b,N);}).fail(function(b){jQuery.sap.log.error("Notifications control - call to notificationsService.getNotificationsBufferBySortingType failed: ",b,"sap.ushell.components.shell.Notifications.Notifications");});},isMoreCircleExist:function(s){var S=this.getNotificationList(s),i=S.getItems().length,l=S.getItems()[i-1];return!!i&&l.getMetadata().getName()==="sap.m.CustomListItem";},handleMaxReached:function(s){var S=this.getNotificationList(s),n=Math.floor(this.oNotificationsService.getNotificationsCount()),m=n-this.iMaxNotificationItemsForDevice,i=this.isMoreCircleExist(s);this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/moreNotificationCount",m);this.getView().getModel().setProperty("/"+this.sCurrentSorting+"/listMaxReached",m>=0);if(m>0&&!i){S.addItem(this.getMoreCircle(this.sCurrentSorting));}else if(m<=0&&i){S.removeItem(this.oMoreListItem);}},reAddFailedGroup:function(g){var m=this.getView().getModel(),G=m.getProperty('/notificationsByTypeDescending');G.splice(g.removedGroupIndex,0,g.oGroup);m.setProperty('/notificationsByTypeDescending',G);},removeGroupFromModel:function(g){var m=this.getView().getModel(),G=m.getProperty('/notificationsByTypeDescending'),R={oGroup:g,removedGroupIndex:undefined};G.some(function(o,i){if(o.Id===g.Id){R.removedGroupIndex=i;G.splice(i,1);m.setProperty('/notificationsByTypeDescending',G);return true;}return false;});this.sCurrentExpandedType=undefined;return R;},updateGroupHeaders:function(){var p=this.oNotificationsService.getNotificationsGroupHeaders(),t=this,g=t.getView().getModel().getProperty("/"+t.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING);p.fail(function(d){jQuery.sap.log.error("Notifications control - call to notificationsService.updateGroupHeaders failed: ",d,"sap.ushell.components.shell.Notifications.Notifications");});p.done(function(n){var j=JSON.parse(n),a=j.value;a.forEach(function(i,b){var f=false;g.forEach(function(c,I){if(c.Id===i.Id){g[I].GroupHeaderText=i.GroupHeaderText;g[I].CreatedAt=i.CreatedAt;f=true;}});if(!f){g.unshift(i);}});t.getView().getModel().setProperty("/"+t.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,g);});},reloadGroupHeaders:function(){var p=this.oNotificationsService.getNotificationsGroupHeaders(),t=this;p.fail(function(d){jQuery.sap.log.error("Notifications control - call to notificationsService.getNotificationsGroupHeaders failed: ",d,"sap.ushell.components.shell.Notifications.Notifications");t.removeBusyIndicatorToTabFilter(t.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING);});p.done(function(n){var j=JSON.parse(n),a=j.value,b=[];a.forEach(function(i,c){if(i.IsGroupHeader){i.Collapsed=true;b.push(i);}});t.getView().getModel().setProperty("/"+t.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,b);t.removeBusyIndicatorToTabFilter(t.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING);});},markRead:function(n){var p=this.oNotificationsService.markRead(n),t=this;p.fail(function(){sap.ushell.Container.getService('Message').error(sap.ushell.resources.i18n.getText('notificationsFailedMarkRead'));t.setMarkReadOnModel(n,false);});this.setMarkReadOnModel(n,true);},onExit:function(){},onBeforeRendering:function(){this.oNotificationsService.registerDependencyNotificationsUpdateCallback(this.notificationsUpdateCallback.bind(this),false);},executeAction:function(n,a){return this.oNotificationsService.executeAction(n,a);},executeBulkAction:function(a,s,g,p){var t=g,P=this.oNotificationsService.executeBulkAction(g.Id,a),m,G=s,n=this.getView().getModel().getProperty(p+"/NotificationTypeDesc"),b=this;if(n===""){n=this.getView().getModel().getProperty(p+"/NotificationTypeKey");}P.fail(function(R){this.getView().getModel().setProperty(p+"/Busy",false);if(R&&R.succededNotifications&&R.succededNotifications.length){R.succededNotifications.forEach(function(N,i){this.removeNotificationFromModel(N);}.bind(this));b.cleanModel();}if(R.succededNotifications.length===1){m=sap.ushell.resources.i18n.getText("notificationsPartialSuccessExecuteBulkAction",[G,R.succededNotifications.length,R.failedNotifications.length+R.succededNotifications.length,n,R.failedNotifications.length]);sap.m.MessageToast.show(m,{duration:4000});}else if(R.succededNotifications.length>1){m=sap.ushell.resources.i18n.getText("notificationsSingleSuccessExecuteBulkAction",[G,R.succededNotifications.length,R.failedNotifications.length+R.succededNotifications.length,n,R.failedNotifications.length]);sap.m.MessageToast.show(m,{duration:4000});}else{m=sap.ushell.resources.i18n.getText("notificationsFailedExecuteBulkAction");sap.ushell.Container.getService('Message').error(m);}}.bind(this));P.done(function(){m=sap.ushell.resources.i18n.getText("notificationsSuccessExecuteBulkAction",[G,n]);sap.m.MessageToast.show(m,{duration:4000});this.removeGroupFromModel(t);this.cleanModel();}.bind(this));},dismissNotification:function(n){var t=this,R=this.removeNotificationFromModel(n),p=this.oNotificationsService.dismissNotification(n);this.cleanModel();p.fail(function(){sap.ushell.Container.getService('Message').error(sap.ushell.resources.i18n.getText('notificationsFailedDismiss'));t.addNotificationToModel(R.obj,R.index);});},dismissBulkNotifications:function(g){var R=this.removeGroupFromModel(g),p=this.oNotificationsService.dismissBulkNotifications(g.Id);this.cleanModel();p.fail(function(){sap.ushell.Container.getService('Message').error(sap.ushell.resources.i18n.getText('notificationsFailedExecuteBulkAction'));this.reAddFailedGroup(R);}.bind(this));},onListItemPress:function(n,s,a,p){var v=sap.ui.getCore().byId('viewPortContainer');if(v){v.switchState("Center");}u.toExternalWithParameters(s,a,p);this.markRead(n);},scrollToItem:function(t){var j=this._getJqNotificationObjects(),a=j[0],b=j[1],c=j[2],d=j[3],i,n,e,f,g;if(a.length>0&&b.length>0&&c.length>0&&d.length>0){i=d.outerHeight(true)-window.parseInt(d.css("margin-top").replace("px",""));n=this.getIndexInModelByItemId(t.topItemId);n=n||0;e=n*i+window.parseInt(d.css("margin-top").replace("px",""));f=window.parseInt(b.css("padding-top").replace("px",""))+window.parseInt(c.css("padding-top").replace("px",""));g=a.offset().top;a.scrollTop(e+f+g-t.offSetTop);}this._oTopNotificationData=undefined;},_getJqNotificationObjects:function(){var j=jQuery("#notificationIconTabBar-containerContent"),a=j.children(),b=a.children(),c=j.find("li").first();return[j,a,b,c];},getTopOffSet:function(){var t=0,j=this._getJqNotificationObjects()[0];if(j.children().length>0&&j.children().children().length>0){t+=j.children().outerHeight()-j.children().height();t+=j.children().children().outerHeight()-j.children().children().height();}return t;},getTopItemOnTheScreen:function(){var j=this._getJqNotificationObjects()[0],t=0,i,a=0,b=this;t=this.getTopOffSet();j.find("li").each(function(){a=jQuery(this).offset().top;if(a>=t){i=b.getItemNotificationId(this);return false;}});return{topItemId:i,offSetTop:a};},handleError:function(){try{sap.ushell.Container.getService("Message").error(sap.ushell.resources.i18n.getText("errorOccurredMsg"));}catch(e){jQuery.sap.log.error("Getting Message service failed.");}},addBusyIndicatorToTabFilter:function(s){var l=this.getNotificationList(s);l.setBusy(true);l.setShowNoData(false);},removeBusyIndicatorToTabFilter:function(s){var l=this.getNotificationList(s);l.setBusy(false);l.setShowNoData(true);},addNotificationToModel:function(n,i){var m=this.getView().getModel(),a=m.getProperty("/"+this.sCurrentSorting+"/aNotifications");a.splice(i,0,n);m.setProperty("/"+this.sCurrentSorting+"/aNotifications",a);},removeNotificationFromModel:function(n){var m=this.getView().getModel(),i,g,a,N,R={};if(this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING||this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING||this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING){N="/"+this.sCurrentSorting+"/aNotifications";a=m.getProperty(N);a.some(function(b,i,c){if(b.Id&&b.Id===n){R.obj=c.splice(i,1)[0];R.index=i;return true;}});m.setProperty(N,a);return R;}g=m.getProperty("/notificationsByTypeDescending");for(i=0;i<g.length;i++){a=g[i].aNotifications;if(a){if(a.length===1&&a[0].Id===n){g.splice(i,1);}else{a.some(function(b,i,c){if(b.Id&&b.Id===n){R.obj=c.splice(i,1)[0];R.index=i;return true;}});g[i].aNotifications=a;}}}this.updateGroupHeaders();m.setProperty("/notificationsByTypeDescending",g);return R;},getIndexInModelByItemId:function(n){var N,i;if(this.notificationsByTypeDescending===this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING){N=this.getView().getModel().getProperty("/"+this.sCurrentExpandedType+"/aNotifications");}else{N=this.getView().getModel().getProperty("/"+this.sCurrentSorting+"/aNotifications");}if(N===undefined||N.length===0){return 0;}for(i=0;i<N.length;i++){if(N[i].Id===n){return i;}}},cleanModel:function(){var t=this,s=this.getView().getModel().getProperty("/");Object.keys(s).forEach(function(S){if(S!==t.sCurrentSorting&&S!==t.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING){s[S]=t.getInitialSortingModelStructure();}});this.getView().getModel().setProperty("/",s);},replaceItemsInModel:function(s,R,n){var c=this.getItemsFromModel(s),i=c.length,h=R.length>=n;if(i){this._oTopNotificationData=this.getTopItemOnTheScreen();}this.getView().getModel().setProperty("/"+s+"/hasMoreItemsInBackend",h);this.getView().getModel().setProperty("/"+s+"/aNotifications",R);this.getView().getModel().setProperty("/"+s+"/inUpdate",false);this.handleMaxReached(s);},setMarkReadOnModel:function(n,I){var m=this.getView().getModel(),p="/"+this.sCurrentSorting,N,d,g,i;d=m.getProperty(p);if(this.sCurrentSorting==="notificationsByTypeDescending"){for(i=0;i<d.length;i++){if(d[i].Id===this.sCurrentExpandedType){p=p+"/"+i;g=true;break;}}if(!g){return;}}p=p+"/aNotifications";N=m.getProperty(p);N.some(function(a){if(a.Id===n){a.IsRead=I;return true;}});m.setProperty(p,N);},onTabSelected:function(e){var k=e.getParameter("key");if(k==="sapUshellNotificationIconTabByDate"){var b;if(this.oPreviousTabKey==="sapUshellNotificationIconTabByDate"){b=this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING?this.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING:this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING;this._changeDateListBinding(b,e.getParameter("item"));this.oPreviousByDateSorting=b;}else{b=this.oPreviousByDateSorting;}this.sCurrentSorting=b;if(this.getItemsFromModel(b).length===0){this.getNextBuffer(b);}}else if(k==="sapUshellNotificationIconTabByType"&&this.oPreviousTabKey!=="sapUshellNotificationIconTabByType"){this.sCurrentSorting=this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING;this.addBusyIndicatorToTabFilter(this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING);this.reloadGroupHeaders();this.getView().byId("notificationIconTabBar").addStyleClass('sapUshellNotificationIconTabByTypeWithBusyIndicator');}else{this.sCurrentSorting=this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING;if(this.getItemsFromModel(this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING).length===0){this.getNextBuffer(this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING);}}this.oPreviousTabKey=k;},_changeDateListBinding:function(s,t){if(s===this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING){t.setTooltip(r.i18n.getText('notificationsSortByDateDescendingTooltip'));this.getView().byId("sapUshellNotificationsListDate").bindItems("/notificationsByDateDescending/aNotifications",sap.ui.xmlfragment("sap.ushell.components.shell.Notifications.fiori3.NotificationsListItem",this));}else{t.setTooltip(r.i18n.getText('notificationsSortByDateAscendingTooltip'));this.getView().byId("sapUshellNotificationsListDate").bindItems("/notificationsByDateAscending/aNotifications",sap.ui.xmlfragment("sap.ushell.components.shell.Notifications.fiori3.NotificationsListItem",this));}},onNotificationItemPress:function(e){var m=e.getSource().getBindingContextPath(),M=this.getView().getModel().getProperty(m),s=M.NavigationTargetObject,a=M.NavigationTargetAction,p=M.NavigationTargetParams,n=M.Id;this.onListItemPress(n,s,a,p);},onNotificationItemClose:function(e){this._retainFocus();var n=e.getSource().getBindingContextPath(),N=this.getView().getModel().getProperty(n),s=N.Id;this.dismissNotification(s);},onNotificationItemButtonPress:function(e){this._retainFocus();var n=e.getSource().getBindingContext().getPath(),m=this.getView().getModel(),N=m.getProperty(n),p=n.split("/"),t=this.sCurrentSorting===this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,P=t?"/"+p[1]+"/"+p[2]+"/"+p[3]+"/"+p[4]:"/"+p[1]+"/"+p[2]+"/"+p[3],o=m.getProperty(P),s=o.Id;m.setProperty(P+"/Busy",true);this.executeAction(s,N.ActionId).done(function(a){if(a&&a.isSucessfull){sap.ui.require(['sap/m/MessageToast'],function(M){if(a.message&&a.message.length){M.show(a.message,{duration:4000});}else{var b=N.ActionText;M.show(r.i18n.getText("ActionAppliedToNotification",b),{duration:4000});}});if(a.DeleteOnReturn!==false){this.removeNotificationFromModel(s);sap.ushell.Container.getService('Notifications')._addDismissNotifications(s);this.cleanModel();}}else if(a){sap.ushell.Container.getService('Message').error(a.message);}else{sap.ushell.Container.getService('Message').error(r.i18n.getText('notificationsFailedExecuteAction'));}m.setProperty(P+"/Busy",false);}.bind(this)).fail(function(){m.setProperty(P+"/Busy",false);sap.ushell.Container.getService('Message').error(r.i18n.getText('notificationsFailedExecuteAction'));}.bind(this));},onNotificationGroupItemClose:function(e){var n=e.getSource().getBindingContext().getPath(),p=n.split("/"),P="/"+p[1]+"/"+p[2],N=this.getView().getModel().getProperty(P);this.dismissBulkNotifications(N);},onNotificationGroupItemCollapse:function(e){var g=e.getSource(),p=g.getBindingContext().getPath();if(!g.getCollapsed()){this.getView().getModel().setProperty(p+"/Busy",true);this.expandedGroupIndex=p.substring(p.lastIndexOf("/")+1);this.onExpandGroup(g);}},onNotificationGroupItemButtonPress:function(e){var m=this.getView().getModel(),n=e.getSource().getBindingContext().getPath(),N=m.getProperty(n),p=n.split("/"),P="/"+p[1]+"/"+p[2],o=m.getProperty(P);this._retainFocus();m.setProperty(P+"/Busy",true);this.executeBulkAction(N.ActionId,e.getSource().getProperty("text"),o,P);},onListUpdateStarted:function(e){if(e.getParameter("reason")==="Growing"){if(!this.getView().getModel().getProperty("/"+this.sCurrentSorting+"/inUpdate")){this.getNextBuffer();}}},getNumberOfItemsInScreen:function(){var i,h=this.getWindowSize();i=(h-this.oPagingConfiguration.TAB_BAR_HEIGHT)/this.oPagingConfiguration.NOTIFICATION_ITEM_HEIGHT;return Math.ceil(i);},getBasicBufferSize:function(){return Math.max(this.getNumberOfItemsInScreen()*3,this.oPagingConfiguration.MIN_NOTIFICATION_ITEMS_PER_BUFFER);},getWindowSize:function(){return jQuery(window).height();},getNumberOfItemsToFetchOnScroll:function(s){var c=this.getItemsFromModel(s).length,b=this.getBasicBufferSize();if(c>=this.iMaxNotificationItemsForDevice){return 0;}if(c+b>this.iMaxNotificationItemsForDevice){return this.iMaxNotificationItemsForDevice-c;}return b;},getNumberOfItemsToFetchOnUpdate:function(n){var b=this.getBasicBufferSize(),N=Math.ceil(n/b),R;R=N>0?N*b:b;return R>this.iMaxNotificationItemsForDevice?this.iMaxNotificationItemsForDevice:R;},getItemsFromModel:function(s){if(s===undefined){s=this.sCurrentSorting;}return this.getView().getModel().getProperty("/"+s+"/aNotifications");},getItemsOfTypeFromModel:function(t){var g=this.getGroupFromModel(t);if(g){return g.aNotifications?g.aNotifications:[];}return[];},getGroupFromModel:function(t){var g=this.getView().getModel().getProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING);return g.find(function(a){return a.Id===t;});},getGroupIndexFromModel:function(t){var g=this.getView().getModel().getProperty("/"+this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING),i;g.forEach(function(a,b){if(a.Id===t){i=b;return true;}});return i;},getItemNotificationId:function(e){var i,I;i=sap.ui.getCore().byId(e.getAttribute("Id")).getBindingContext().sPath;I=this.getView().getModel().getProperty(i+"/Id");return I;},getInitialSortingModelStructure:function(){return{hasMoreItemsInBackend:true,listMaxReached:false,aNotifications:[],inUpdate:false,moreNotificationCount:""};},onExpandGroup:function(g){var l=this.getView().byId("sapUshellNotificationsListType").getItems(),a=g.getId(),G=this.getView().getModel().getProperty(g.getBindingContextPath()),t=this;t.sCurrentExpandedType=G.Id;t.getView().getModel().setProperty(g.getBindingContextPath()+"/aNotifications",[]);t.getView().getModel().setProperty(g.getBindingContextPath()+"/hasMoreItems",true);l.forEach(function(i,b){if(i.getId()===a){t.getNextBufferForType();}else if(i.getId()!==a&&!i.getCollapsed()){i.setCollapsed(true);t.getView().getModel().setProperty(i.getBindingContextPath()+"/hasMoreItems",true);}});},notificationsUpdateCallbackForType:function(){var s=this.sCurrentExpandedType,S=this.oSortingType.NOTIFICATIONS_BY_TYPE_DESCENDING,g=this.getGroupFromModel(s),c=g?g.aNotifications:undefined,n=0,p;if(c!==undefined){n=c.length;}this.getView().getModel().setProperty("/"+S+"/inUpdate",true);this.updateGroupHeaders();if(s){p=this.oNotificationsService.getNotificationsBufferInGroup(s,0,this.getNumberOfItemsToFetchOnUpdate(n));p.done(function(R){this.addTypeBufferToModel(s,R,true);}.bind(this));p.fail(function(R){this.getNextBufferFailHandler(R);}.bind(this));}},getNotificationList:function(s){var l;if(s===this.oSortingType.NOTIFICATIONS_BY_DATE_DESCENDING||s===this.oSortingType.NOTIFICATIONS_BY_DATE_ASCENDING){l=this.getView().byId("sapUshellNotificationsListDate");}else if(s===this.oSortingType.NOTIFICATIONS_BY_PRIORITY_DESCENDING){l=this.getView().byId("sapUshellNotificationsListPriority");}else{l=this.getView().byId("sapUshellNotificationsListType");}return l;},removeTabIndexFromList:function(s){var l=this.getNotificationList(s);var L=l.$().children().get(1);if(L){L.removeAttribute("tabindex");}},handleListCSSClass:function(s,i){this.getNotificationList(s).toggleStyleClass("sapContrast",i);this.getNotificationList(s).toggleStyleClass("sapContrastPlus",i);},getMoreCircle:function(t){var m=new T({text:r.i18n.getText('moreNotifications')}),n=new T({text:""}).addStyleClass("sapUshellNotificationsMoreCircleCount"),M=new V({items:[n,m],alignItems:sap.m.FlexAlignItems.Center}).addStyleClass("sapUshellNotificationsMoreCircle"),b=new T({text:r.i18n.getText('moreNotificationsAvailable_message'),textAlign:"Center"}).addStyleClass("sapUshellNotificationsMoreHelpingText"),B=new T({text:r.i18n.getText('processNotifications_message'),textAlign:"Center"}).addStyleClass("sapUshellNotificationsMoreHelpingText"),v=new V({items:[M,b,B]}).addStyleClass("sapUshellNotificationsMoreVBox"),l=new C({type:sap.m.ListType.Inactive,content:v}).addStyleClass("sapUshellNotificationsMoreListItem sapContrastPlus");n.setModel(this.getView().getModel());n.bindText("/"+t+"/moreNotificationCount");this.oMoreListItem=l;return l;},_retainFocus:function(){var i=this.getView().byId("notificationIconTabBar"),k=i.getSelectedKey(),I=i.getItems(),s=0;I.forEach(function(o,a){if(o.getKey()===k){s=a;}});I[s].focus();},priorityFormatter:function(p){if(p){p=p.charAt(0)+p.substr(1).toLowerCase();return sap.ui.core.Priority[p];}},buttonTypeFormatter:function(n){switch(n){case"POSITIVE":return"Accept";case"NEGATIVE":return"Reject";default:return"Default";}}});},false);},"sap/ushell/components/shell/Notifications/fiori3/Notifications.view.xml":'<mvc:View\n    controllerName="sap.ushell.components.shell.Notifications.fiori3.Notifications"\n    xmlns="sap.m"\n    xmlns:mvc="sap.ui.core.mvc"\n    xmlns:core="sap.ui.core"\n    class="sapUshellNotificationsView">\n    <IconTabBar\n        id="notificationIconTabBar"\n        backgroundDesign="Transparent"\n        expandable="false"\n        selectedKey="sapUshellNotificationIconTabByDate"\n        select="onTabSelected"\n        class="sapUshellNotificationTabBar">\n        <items>\n            <IconTabFilter\n                id="sapUshellNotificationIconTabByDate"\n                key="sapUshellNotificationIconTabByDate"\n                text="{i18n>notificationsSortByDate}"\n                tooltip="{i18n>notificationsSortByDateDescendingTooltip}">\n                <List\n                    id="sapUshellNotificationsListDate"\n                    class="sapUshellNotificationsList sapContrast sapContrastPlus sapUshellPopoverList"\n                    mode="None"\n                    noDataText="{i18n>noNotificationsMsg}"\n                    growing="true"\n                    growingThreshold="10"\n                    growingScrollToLoad="true"\n                    updateStarted=".onListUpdateStarted"\n                    items="{path: \'/notificationsByDateDescending/aNotifications\', templateShareable: true}">\n                    <core:Fragment fragmentName="sap.ushell.components.shell.Notifications.fiori3.NotificationsListItem" type="XML"/>\n                </List>\n            </IconTabFilter>\n            <IconTabFilter\n                id="sapUshellNotificationIconTabByType"\n                key="sapUshellNotificationIconTabByType"\n                text="{i18n>notificationsSortByType}"\n                tooltip="{i18n>notificationsSortByTypeTooltip}">\n                <core:Fragment fragmentName="sap.ushell.components.shell.Notifications.fiori3.NotificationsGroupListItem" type="XML"/>\n            </IconTabFilter>\n            <IconTabFilter\n                id="sapUshellNotificationIconTabByPrio"\n                key="sapUshellNotificationIconTabByPrio"\n                text="{i18n>notificationsSortByPriority}"\n                tooltip="{i18n>notificationsSortByPriorityTooltip}">\n                <List\n                    id="sapUshellNotificationsListPriority"\n                    class="sapUshellNotificationsList sapContrast sapContrastPlus sapUshellPopoverList"\n                    mode="None"\n                    noDataText="{i18n>noNotificationsMsg}"\n                    growing="true"\n                    growingThreshold="10"\n                    growingScrollToLoad="true"\n                    updateStarted=".onListUpdateStarted"\n                    items="{path: \'/notificationsByPriorityDescending/aNotifications\', templateShareable: true}">\n                    <core:Fragment fragmentName="sap.ushell.components.shell.Notifications.fiori3.NotificationsListItem" type="XML"/>\n                </List>\n            </IconTabFilter>\n        </items>\n    </IconTabBar>\n</mvc:View>',"sap/ushell/components/shell/Notifications/fiori3/NotificationsGroupListItem.fragment.xml":'<core:FragmentDefinition xmlns="sap.m" xmlns:core="sap.ui.core">\n\n    <List\n        id="sapUshellNotificationsListType"\n        class="sapUshellNotificationsList sapContrastPlus sapContrast sapUshellPopoverList"\n        mode="SingleSelect"\n        noDataText="{i18n>noNotificationsMsg}"\n        items="{/notificationsByTypeDescending}">\n        <NotificationListGroup\n            title="{GroupHeaderText}"\n            collapsed="{Collapsed}"\n            showEmptyGroup="true"\n            enableCollapseButtonWhenEmpty="true"\n            autoPriority="false"\n            datetime="{path: \'CreatedAt\', formatter: \'sap.ushell.utils.formatDate\'}"\n            priority="{ path: \'Priority\', formatter: \'.priorityFormatter\'}"\n            busy="{= ${Busy} ? ${Busy} : false}"\n            buttons="{\n                path:\'Actions\',\n                templateShareable: \'true\',\n                sorter: {\n                    path: \'Nature\',\n                    descending: \'true\'\n                }\n            }"\n            items="{\n                path: \'aNotifications\',\n                templateShareable: \'true\'\n            }"\n            close="onNotificationGroupItemClose"\n            onCollapse="onNotificationGroupItemCollapse">\n            <core:Fragment fragmentName="sap.ushell.components.shell.Notifications.fiori3.NotificationsListItem" type="XML"/>\n            <buttons>\n                <Button\n                    press="onNotificationGroupItemButtonPress"\n                    text="{GroupActionText}"\n                    type="{ path: \'Nature\', formatter: \'.buttonTypeFormatter\'}"/>\n            </buttons>\n        </NotificationListGroup>\n    </List>\n</core:FragmentDefinition>',"sap/ushell/components/shell/Notifications/fiori3/NotificationsListItem.fragment.xml":'<core:FragmentDefinition xmlns="sap.m" xmlns:core="sap.ui.core">\n    <NotificationListItem\n        class="sapUshellNotificationsListItem sapContrastPlus sapContrast"\n        press="onNotificationItemPress"\n        close="onNotificationItemClose"\n        datetime="{path: \'CreatedAt\', formatter: \'sap.ushell.utils.formatDate\'}"\n        description="{SubTitle}"\n        title="{= ${SensitiveText} ? ${SensitiveText} : ${Text}}"\n        buttons="{\n            path: \'Actions\',\n            sorter: {\n                path: \'Nature\',\n                descending: true\n            },\n            templateShareable: true\n        }"\n        unread="{= !${IsRead}}"\n        busy="{= ${Busy} ? ${Busy} : false}"\n        priority="{ path: \'Priority\', formatter: \'.priorityFormatter\'}">\n        <buttons>\n            <Button\n                text="{ActionText}"\n                type="{ path: \'Nature\', formatter: \'.buttonTypeFormatter\'}"\n                press="onNotificationItemButtonPress"/>\n        </buttons>\n    </NotificationListItem>\n</core:FragmentDefinition>\n'},"Component-preload");
