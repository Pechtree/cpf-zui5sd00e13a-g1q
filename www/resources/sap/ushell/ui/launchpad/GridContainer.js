// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/core/Control","sap/ushell/library","sap/ui/core/Icon","sap/m/Input","sap/m/Text","sap/ushell/resources","sap/ui/layout/cssgrid/CSSGrid","sap/ui/layout/cssgrid/GridSettings","sap/ui/layout/cssgrid/GridResponsiveLayout","sap/ui/layout/cssgrid/GridItemLayoutData","sap/ushell/ui/launchpad/GridContainerRenderer","sap/ushell/utils","sap/ushell/ui/launchpad/Tile"],function(M,C,l,I,a,T,r,b,G,c,d,e,U,f){"use strict";var g=C.extend("sap.ushell.ui.launchpad.GridContainer",{metadata:{library:"sap.ushell",properties:{groupId:{type:"string",group:"Misc",defaultValue:null},showHeader:{type:"boolean",group:"Misc",defaultValue:true},defaultGroup:{type:"boolean",group:"Misc",defaultValue:false},isLastGroup:{type:"boolean",group:"Misc",defaultValue:false},headerText:{type:"string",group:"Misc",defaultValue:null},headerLevel:{type:"sap.m.HeaderLevel",group:"Misc",defaultValue:sap.m.HeaderLevel.H2},groupHeaderLevel:{type:"sap.m.HeaderLevel",group:"Misc",defaultValue:sap.m.HeaderLevel.H4},showGroupHeader:{type:"boolean",group:"Misc",defaultValue:true},homePageGroupDisplay:{type:"string",defaultValue:null},isGroupLocked:{type:"boolean",group:"Misc",defaultValue:null},isGroupSelected:{type:"boolean",group:"Misc",defaultValue:false},editMode:{type:"boolean",group:"Misc",defaultValue:false},showBackground:{type:"boolean",group:"Misc",defaultValue:false},icon:{type:"string",group:"Misc",defaultValue:"sap-icon://locked"},showIcon:{type:"boolean",group:"Misc",defaultValue:false},enableHelp:{type:"boolean",group:"Misc",defaultValue:false},tileActionModeActive:{type:"boolean",group:"Misc",defaultValue:false},ieHtml5DnD:{type:"boolean",group:"Misc",defaultValue:false},showEmptyLinksArea:{type:"boolean",group:"Misc",defaultValue:false},showEmptyLinksAreaPlaceHolder:{type:"boolean",group:"Misc",defaultValue:false},supportLinkPersonalization:{type:"boolean",group:"Misc",defaultValue:false}},aggregations:{tiles:{type:"sap.ui.core.Control",multiple:true,singularName:"tile",forwarding:{getter:"_getInternalGrid",aggregation:"items"}},links:{type:"sap.ui.core.Control",multiple:true,singularName:"link"},_grid:{type:"sap.ui.layout.cssgrid.CSSGrid",multiple:false,visibility:"hidden"},beforeContent:{type:"sap.ui.core.Control",multiple:true,singularName:"beforeContent"},afterContent:{type:"sap.ui.core.Control",multiple:true,singularName:"afterContent"},footerContent:{type:"sap.ui.core.Control",multiple:true,singularName:"footerContent"},headerActions:{type:"sap.ui.core.Control",multiple:true,singularName:"headerAction"}},events:{afterRendering:{},titleChange:{}}}});g.prototype.init=function(){this.setAggregation("_grid",new b({customLayout:new c({layoutS:new G({gridTemplateColumns:"repeat(auto-fill, 4.375rem)",gridAutoRows:"4.375rem",gridAutoFlow:"Row",gridRowGap:"0.5rem",gridColumnGap:"0.5rem"}),layoutM:new G({gridTemplateColumns:"repeat(auto-fill, 5.25rem)",gridAutoRows:"5.25rem",gridAutoFlow:"Row",gridRowGap:"0.5rem",gridColumnGap:"0.5rem"}),layoutL:new G({gridTemplateColumns:"repeat(auto-fill, 5.25rem)",gridAutoRows:"5.25rem",gridAutoFlow:"Row",gridRowGap:"0.5rem",gridColumnGap:"0.5rem"}),layoutXL:new G({gridTemplateColumns:"repeat(auto-fill, 5.25rem)",gridAutoRows:"5.25rem",gridAutoFlow:"RowDense",gridRowGap:"0.5rem",gridColumnGap:"0.5rem"})})}));this.oNoLinksText=new T({text:r.i18n.getText("emptyLinkContainerInEditMode")}).addStyleClass("sapUshellNoLinksAreaPresentTextInner");this.oTransformationErrorText=new T({text:r.i18n.getText("transformationErrorText")}).addStyleClass("sapUshellTransformationErrorText");this.oTransformationErrorIcon=new I({src:"sap-icon://message-error"}).addStyleClass("sapUshellTransformationErrorIcon");this.oIcon=new I({src:this.getIcon()});this.oIcon.addStyleClass("sapUshellContainerIcon");this.oEditInputField=new a({placeholder:r.i18n.getText("new_group_name"),value:this.getHeaderText()}).addStyleClass("sapUshellTileContainerTitleInput");this.oEditInputField.addEventDelegate({onfocusout:this.setEditMode.bind(this,false),onsapenter:this.setEditMode.bind(this,false)});};g.prototype.exit=function(){if(this.oNoLinksText){this.oNoLinksText.destroy();}if(this.oTransformationErrorText){this.oTransformationErrorText.destroy();}if(this.oTransformationErrorIcon){this.oTransformationErrorIcon.destroy();}if(this.oIcon){this.oIcon.destroy();}if(this.oEditInputField){this.oEditInputField.destroy();}C.prototype.exit.apply(this,arguments);};g.prototype.onAfterRendering=function(){var t=this;var o=window.document.getElementById(this.getId()+"-titleText");if(o){o.addEventListener("click",function(){var h=t.getModel()&&t.getModel().getProperty("/enableRenameLockedGroup"),i=(h||!t.getIsGroupLocked())&&!t.getDefaultGroup()&&t.getTileActionModeActive();t.setEditMode(i);});}var E=this.oEditInputField.getDomRef();if(E){setTimeout(function(){E.querySelector("input").focus();},100);}this.fireAfterRendering();};g.prototype.getShowPlaceholder=function(){return false;};g.prototype.setGroupId=function(v){this.setProperty("groupId",v,true);return this;};g.prototype.groupHasTiles=function(){var t=this.getTiles();if(this.getBindingContext()){var p=this.getBindingContext().sPath;t=this.getModel().getProperty(p).tiles;}return sap.ushell.utils.groupHasVisibleTiles(t,[]);};g.prototype.getInnerContainersDomRefs=function(){var o=this.getDomRef();if(!o){return null;}var i=o.querySelector(".sapUshellTilesContainer-sortable"),L=o.querySelector(".sapUshellLineModeContainer");return[i,L];};g.prototype.setEditMode=function(v){if(this.getEditMode()===v){return;}this.setProperty("editMode",v,false);this.getModel().setProperty("/editTitle",v,false);if(v){this.addStyleClass("sapUshellEditing");this.oEditInputField.setValue(this.getHeaderText());var E=sap.ui.getCore().getEventBus();E.publish("launchpad","scrollToGroup",{group:this,groupChanged:false,focus:false});}else{this.removeStyleClass("sapUshellEditing");var n=this.oEditInputField.getValue();n=n.substring(0,256).trim()||this.oEditInputField.getPlaceholder();if(n!==this.getHeaderText()){this.fireTitleChange({newTitle:n});this.setHeaderText(n);}}};g.prototype.setShowEmptyLinksArea=function(v){this.setProperty("showEmptyLinksArea",v,true);this.toggleStyleClass("sapUshellLinksAreaHidden",!v);};g.prototype.setShowEmptyLinksAreaPlaceHolder=function(v){this.setProperty("showEmptyLinksArea",v,true);this.toggleStyleClass("sapUshellTileContainerEditMode",v);this.toggleStyleClass("sapUshellTileContainerTabsModeEmptyLinksArea",v);this.toggleStyleClass("sapUshellEmptyLinksAreaPlaceHolder",!v);};g.prototype._getInternalGrid=function(){return this.getAggregation("_grid");};g.prototype.addAggregation=function(A,o){C.prototype.addAggregation.apply(this,arguments);if(A==="tiles"){this._addItemLayoutData(o);}return this;};g.prototype.insertAggregation=function(A,o,i){C.prototype.insertAggregation.apply(this,arguments);if(A==="tiles"){this._addItemLayoutData(o);}return this;};g.prototype._addItemLayoutData=function(i){var L,o;if(i instanceof f){L={gridRow:"span 2",gridColumn:{path:"long",formatter:g._getItemLayoutColumn}};}else{var h=i.getManifest(),s=U.getMember(h,"sap|flp.rows")||3,j=U.getMember(h,"sap|flp.columns")||3;L={gridRow:"span "+s,gridColumn:"span "+j};}o=new d(L);i.setLayoutData(o);};g._getItemLayoutColumn=function(L){return L?"span 4":"span 2";};return g;});
