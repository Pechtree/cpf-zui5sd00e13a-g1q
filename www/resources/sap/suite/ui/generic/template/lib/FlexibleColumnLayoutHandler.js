sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/f/FlexibleColumnLayoutSemanticHelper","sap/f/library"],function(q,B,F,f){"use strict";var L=f.LayoutType;function o(O){sap.ui.require(["sap/suite/ui/generic/template/lib/routingHelper"],O);}var r=Promise.resolve();var d=2;var c=["begin","mid","end"];var m=["messagePageBeginColumn","messagePageMidColumn","messagePageEndColumn"];function t(i){return c[i]?i:d;}function g(i){return c[t(i)]+"ColumnPages";}function a(C){for(var i=0;i<c.length;i++){C(m[i],g(i));}}function b(v){return m[t(v)];}function e(i){return c[t(i)];}function h(R){return R.name.length>5&&R.name.lastIndexOf("query")===R.name.length-"query".length;}function j(T){var i;if(T instanceof sap.ui.table.Table){i=T.getRows();}else if(T instanceof sap.m.Table){i=T.getItems();}return i;}function k(T){var i=j(T);var R=i?i[0]:false;return R;}function l(s){return(s&&(q.isArray(s.FCLLayout)?s.FCLLayout.sort()[0]:s.FCLLayout))||"";}function n(p,N){var M=N.oTemplateContract.oAppComponent.getConfig();var s=M.settings.flexibleColumnLayout;var u=F.getInstanceFor(p,s);var D=u.getDefaultLayouts();var v;var U;var C;var S;var w=-1;var T=N.oTemplateContract;var x=sap.ui.Device.system.phone?1:(s.maxColumnsCount||3);var y=x>1&&s.initialColumnsCount===2;var z=s.displayNextObjectAfterDelete===true;function A(i){return i.fCLLevel===1||i.fCLLevel===2||(i.level===0&&y);}function E(i){if(i.fCLLevel===3||(i.fCLLevel===0&&i.level>0)){return 1;}var u1=s.initialColumnsCount||1;var v1=Math.max(i.fCLLevel+1,u1);return sap.ui.Device.system.tablet&&v1>2?2:v1;}function G(i,u1,v1,w1){var x1=E(w1);i.showBeginColumn=w1.fCLLevel===0||x1>1;i.showMidColumn=w1.fCLLevel===1||x1>1;i.showEndColumn=w1.fCLLevel>1;if(x1===1){i.target=u1;}else if(w1.level===0){i.target=[u1,i.pages[0].entitySet];}else{i.target=v1.concat([u1]);}return g(w1.fCLLevel);}function H(i,u1){if(i===L.OneColumn&&y){return false;}var v1=u1&&T.mRoutingTree[N.removeQueryInRouteName(u1)];var w1=v1&&v1.defaultLayoutType;if(w1){return i===w1;}return i===D.defaultLayoutType||i===D.defaultTwoColumnLayoutType||i===D.defaultThreeColumnLayoutType;}function I(i,u1,v1){var w1=T.mRouteToTemplateComponentPromise[v1];if(w1){return w1.then(function(x1){return N.activateOneComponent(u1,i,x1);});}return r;}function J(i){var u1=function(v1,w1){if(!v){w1();return;}o(function(x1){var y1={};var z1=N.removeQueryInRouteName(v.event.getParameter("config").name);var A1=true;for(var B1=T.mRoutingTree[z1];A1;B1=T.mRoutingTree[B1.parentRoute]){var C1=B1.fCLLevel;var D1=e(C1);y1[D1]={route:B1.sRouteName,path:x1.determinePath(B1,v.event,i)||"",isVisible:C1>2||U.columnsVisibility[D1+"Column"]};A1=C1===1||C1===2;}v1(y1);});};return new Promise(u1);}function K(i,u1){var v1=J();return v1.then(function(w1){var x1=[];u1=u1||w1;for(var y1 in u1){var z1=w1[y1];if(z1.isVisible){x1.push(I(i,z1.path,z1.route));}else{var A1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");var B1=T.mRoutingTree[z1.route];var C1=(A1===B1.level)?2:(3+Y(C));N.setVisibilityOfRoute(z1.route,C1);}}return Promise.all(x1).then(N.afterActivation);});}function O(i){var u1=N.getActivationInfo();K(u1,i);}function P(){return!(U.columnsVisibility.beginColumn?U.columnsVisibility.midColumn:U.columnsVisibility.midColumn&&U.columnsVisibility.endColumn);}function Q(i){var u1=u.getCurrentUIState();var v1={};v1.end=U&&(U.columnsVisibility.endColumn!==u1.columnsVisibility.endColumn);v1.mid=U&&(U.columnsVisibility.midColumn!==u1.columnsVisibility.midColumn);v1.begin=U&&(U.columnsVisibility.beginColumn!==u1.columnsVisibility.beginColumn);U=u1;T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/midActionButtons",{fullScreen:U.actionButtonsInfo.midColumn.fullScreen!==null,exitFullScreen:U.actionButtonsInfo.midColumn.exitFullScreen!==null,closeColumn:U.actionButtonsInfo.midColumn.closeColumn!==null});T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/endActionButtons",{fullScreen:U.actionButtonsInfo.endColumn.fullScreen!==null,exitFullScreen:U.actionButtonsInfo.endColumn.exitFullScreen!==null,closeColumn:U.actionButtonsInfo.endColumn.closeColumn!==null});var w1=N.getCurrentIdentity();var x1=w1&&w1.treeNode;if(w1){var y1=P();var z1=x1.level-(x1.fCLLevel===2&&!U.columnsVisibility.endColumn);var A1=z1-(z1>1&&!y1)-(U.columnsVisibility.endColumn&&U.columnsVisibility.beginColumn&&z1>2);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/isVisuallyFullScreen",y1);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/highestViewLevel",z1);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/lowestDetailViewLevel",A1);}if(w1&&C!==U.layout){var B1=H(U.layout,x1.sRouteName)?null:U.layout;N.navigateByExchangingQueryParam("FCLLayout",B1);}else if((v1.begin||v1.mid||v1.end)&&!i){O(v1);}}function R(i,u1){i=q.extend({},i);var v1=i.getParameter("name");v={name:v1,arguments:i.getParameter("arguments"),event:i};if(A(u1.treeNode)){C=(l(u1.appStates))||u1.treeNode.defaultLayoutType;if(!C){switch(u1.treeNode.fCLLevel){case 0:var w1=u.getNextUIState(0).columnsVisibility;if(w1.midColumn){C=D.defaultTwoColumnLayoutType;}else{C=D.defaultLayoutType;N.navigateByExchangingQueryParam("FCLLayout",C);}break;case 1:C=D.defaultTwoColumnLayoutType;break;case 2:C=D.defaultThreeColumnLayoutType;}}}else{C=u1.treeNode.fCLLevel===0?D.defaultLayoutType:L.EndColumnFullScreen;}p.setLayout(C);}function V(i,u1,v1,w1){w=-1;v.path=v1;v.routeConfig=u1;if(w1){Q(true);return K(w1);}}function W(i,u1){return i||u1.defaultLayoutType||u.getNextUIState(u1.fCLLevel).layout;}function X(i,u1){return H(i,u1)?{}:{FCLLayout:[i]};}function Y(i){return i===L.EndColumnFullScreen||i===L.MidColumnFullScreen;}function Z(i){return i===L.ThreeColumnsBeginExpandedEndHidden||i===L.ThreeColumnsMidExpandedEndHidden;}function $(i,u1,v1,w1){if(!i.componentId){return;}var x1=null;var y1=N.getApplicableStateForComponentAddedPromise(i.componentId,x1,w1);v1.push(y1);}function _(i,u1,v1){var w1=X(u1,i.sRouteName);var x1=[];if(!Z(u1)){$(i,v1,x1,w1);}if(!Y(u1)){for(var y1=i;y1.fCLLevel>0;){y1=T.mRoutingTree[y1.parentRoute];$(y1,v1,x1,w1);}}return Promise.all(x1).then(function(){return w1;});}function a1(i,u1){var v1=i.fCLLevel===1?U.actionButtonsInfo.endColumn.closeColumn:L.OneColumn;q.extend(u1,X(v1,i.sRouteName));var w1=[];for(var x1=i;x1;x1=x1.fCLLevel&&T.mRoutingTree[x1.parentRoute]){w1.push(N.addUrlParameterInfoForRoute(x1.sRouteName,u1));}return Promise.all(w1);}function b1(i){if(i===0){return L.OneColumn;}else if(i===1){return L.MidColumnFullScreen;}else if(i===2){return L.EndColumnFullScreen;}else{return"";}}function c1(u1,v1){var w1=T.mRoutingTree[u1];if(!A(w1)){return null;}var x1=W(S,w1);q.extend(v1,X(x1,u1));S=null;if(Y(x1)){return null;}var y1=[];for(var i=w1.fCLLevel;i>0;i--){var z1=w1.parentRoute;y1.push(N.addUrlParameterInfoForRoute(z1,v1));w1=T.mRoutingTree[z1];}return Promise.all(y1);}function d1(i,u1){if(i.treeNode.fCLLevel===0||i.treeNode.fCLLevel===3){return true;}var v1=W(l(i.appStates),i.treeNode);var w1=W(l(u1.appStates),u1.treeNode);return Y(v1)===Y(w1);}function e1(i,u1,v1){T.oApplicationProxy.performAfterSideEffectExecution(function(){var w1=e(i.fCLLevel);var x1=U.actionButtonsInfo[w1+"Column"][u1];var y1=v1?T.mRoutingTree[i.parentRoute]:i;var z1=N.getCurrentIdentity();var A1=_(y1,x1,z1.keys);var B1=A1.then(function(C1){N.navigateToIdentity({treeNode:y1,keys:(y1===z1.treeNode)?z1.keys:z1.keys.slice(0,y1.level+1),appStates:C1});});T.oBusyHelper.setBusy(B1);},true);}function f1(i){return{onCloseColumnPressed:e1.bind(null,i,"closeColumn",true),onFullscreenColumnPressed:e1.bind(null,i,"fullScreen",false),onExitFullscreenColumnPressed:e1.bind(null,i,"exitFullScreen",false)};}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL",{});function g1(i){var u1=T.mEntityTree[i.entitySet];var v1=T.oNavigationControllerProxy.getCurrentIdentity();var w1=v1.treeNode;return u1.level>w1.level;}function h1(i){C=u.getNextUIState(i).layout;p.setLayout(C);}function i1(){return!P();}function j1(i,u1){var v1=0;for(var w1 in u1){var x1=T.mRoutingTree[w1];if(x1.level>=i.viewLevel&&u1[w1]===1){if(x1.level===i.viewLevel){v1=x1.fCLLevel;}u1[w1]=5+(x1.level>i.viewLevel);}}w=t(v1);h1(v1);var y1=N.oRouter.getTargets();var z1=b(v1);y1.display(z1);}function k1(i){if(i<w||w<0){return U.columnsVisibility[e(i)+"Column"];}return false;}function l1(i,u1){if(!A(u1)){return;}var v1=b1(u1.level);if(H(v1,u1.sRouteName)){return;}i.FCLLayout=[v1];}function m1(){return x;}function n1(i,u1){if(!y){return;}var v1=false;var w1=u.getNextUIState(0).columnsVisibility;if(w1.midColumn){var x1=v.event.getParameter("config").viewLevel;if(x1===0){v1=true;if(h(v)){v.arguments.query=v.arguments["?query"];if(l(v.arguments.query)===L.OneColumn){v1=false;}}}}if(v1){if(i){u1(i);}else{N.navigateToRoot(true);}}}function o1(){return z;}function p1(){return y;}function q1(i,u1){var v1=k(i);n1(v1,u1);}function r1(){S=L.OneColumn;}function s1(i){if(i>2){S="";}else{S=b1(i);}}function t1(i){var u1={};if(i.fCLLevel===1||i.fCLLevel===2){u1.oActionButtonHandlers=f1(i);}if(i.level===0){u1.handleDataReceived=(p1&&p1())?q1:q.noop;u1.isListAndFirstEntryLoadedOnStartup=p1;}return u1;}p.attachStateChange(Q.bind(null,false));return{adaptRoutingInfo:G,createMessagePageTargets:a,displayMessagePage:j1,isLevelActive:k1,handleBeforeRouteMatched:R,handleRouteMatched:V,areIdentitiesLayoutEquivalent:d1,getAppStatesPromiseForColumnClose:a1,getFCLAppStatesPromise:c1,isNewHistoryEntryRequired:g1,adaptBreadCrumbUrlParameters:l1,isAppTitlePrefered:i1,getFullscreenLayout:b1,getMaxColumnCountInFCL:m1,isNextObjectLoadedAfterDelete:o1,getFclProxy:t1,setStoredTargetLayoutToOneColumn:r1,isListAndFirstEntryLoadedOnStartup:p1,setStoredTargetLayoutToFullscreen:s1};}return B.extend("sap.suite.ui.generic.template.lib.FlexibleColumnLayoutHandler",{constructor:function(i,N){q.extend(this,n(i,N));}});});
